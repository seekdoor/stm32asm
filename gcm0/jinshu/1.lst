ARM GAS  1.s 			page 1


   1              			@ stm32f030f4p6 asm
   2              		 .thumb
   3              		         .syntax unified
   4              		.section .data
   5              	zheng_xian_biao:
   6 0000 1C001D00 		.short 28,29,31,33,34,36,38,39,41,42,44,45,46,48,49,50,51,52,52,53,54,54,55,55,55,55,55,55,55,54,5
   6      1F002100 
   6      22002400 
   6      26002700 
   6      29002A00 
   7 00ca 00000000 		.align 4
   7      0000
   8              		
   9              		.equ STACKINIT,        	        0x20001000
  10              		.equ dianyabiao,		0x20000100
  11              		.equ lvboqizhizhen,		0x20000300
  12              		.equ lvboqihuanchong,		0x20000304
  13              		.equ lvboqizhizhen1,		0x20000600
  14              		.equ lvboqihuanchong1,		0x20000604
  15              	.section .text
  16              	vectors:
  17 0000 00100020 		.word STACKINIT
  18 0004 B1000000 		.word _start + 1
  19 0008 E7010000 		.word _nmi_handler + 1
  20 000c E9010000 		.word _hard_fault  + 1
  21 0010 00000000 		.word 0
  22 0014 00000000 		.word 0
  23 0018 00000000 		.word 0
  24 001c 00000000 		.word 0
  25 0020 00000000 		.word 0
  26 0024 00000000 		.word 0
  27 0028 00000000 		.word 0
  28 002c EB010000 		.word _svc_handler +1
  29 0030 00000000 		.word 0
  30 0034 00000000 		.word 0
  31 0038 ED010000 		.word _pendsv_handler +1
  32 003c EF010000 		.word _systickzhongduan +1               @ 15
  33 0040 EF010000 		.word aaa +1     @ _wwdg +1          @ 0
  34 0044 EF010000 		.word aaa +1     @_pvd +1            @ 1
  35 0048 EF010000 		.word aaa +1     @_rtc +1            @ 2
  36 004c EF010000 		.word aaa +1     @_flash +1          @ 3
  37 0050 EF010000 		.word aaa +1	@ _rcc + 1          @ 4
  38 0054 EF010000 		.word aaa +1	@_exti0_1  +1      @ 5
  39 0058 EF010000 		.word aaa +1      @ _exti2_3 +1      @ 6
  40 005c EF010000 		.word aaa +1       @_exti4_15 +1     @ 7
  41 0060 EF010000 		.word aaa +1                         @ 8
  42 0064 EF010000 		.word aaa +1 	@_dma1_1  +1    @ 9
  43 0068 EF010000 		.word aaa +1    @_dma1_2_3 +1        @ 10
  44 006c EF010000 		.word aaa +1       @_dma1_4_5 +1     @ 11
  45 0070 EF010000 		.word aaa +1	 @_adc1 +1          @ 12
  46 0074 EF010000 		.word aaa +1	@_tim1_brk_up +1  @ 13
  47 0078 EF010000 		.word aaa +1 @_tim1_buhuo +1    @ 14
  48 007c EF010000 		.word aaa +1         @_tim2 +1       @ 15
  49 0080 EF010000 		.word aaa +1          @_tim3 +1      @ 16
  50 0084 EF010000 		.word aaa +1                         @ 17
  51 0088 EF010000 		.word aaa +1		                @ 18
  52 008c EF010000 		.word aaa +1		@_tim14 +1    @ 19
ARM GAS  1.s 			page 2


  53 0090 EF010000 		.word aaa +1                         @ 20
  54 0094 EF010000 		.word aaa +1 	@_tim16 +1      @ 21
  55 0098 EF010000 		.word aaa +1         @_tim17 +1      @ 22
  56 009c EF010000 		.word aaa +1          @_i2c   +1     @ 23
  57 00a0 EF010000 		.word aaa +1                         @ 24
  58 00a4 EF010000 		.word aaa +1           @_spi   +1    @ 25
  59 00a8 EF010000 		.word aaa +1                         @ 26
  60 00ac EF010000 		.word aaa +1         @_usart1 +1     @ 27
  61              	_start:
  62              	shizhong:
  63 00b0 4F4A     	        ldr r2, = 0x40022000   @FLASH访问控制
  64 00b2 3221     	        movs r1, # 0x32
  65 00b4 1160     	        str r1, [r2]           @FLASH缓冲 缓冲开启
  66 00b6 4F48     	        ldr r0, = 0x40021000 @ rcc
  67 00b8 4F49     		ldr r1, = 0x10001
  68 00ba 0160     	        str r1, [r0]
  69              	denghse:
  70 00bc 0168     	        ldr r1, [r0]
  71 00be 8903     	        lsls r1, r1, # 14
  72 00c0 FCD5     	        bpl denghse
  73              	dengpllguan:
  74 00c2 0168     	        ldr r1, [r0]
  75 00c4 8901     		lsls r1, r1, # 6
  76 00c6 FCD4     		bmi dengpllguan
  77 00c8 4C49     		ldr r1, = 0x150002
  78 00ca 0046     		mov r0, r0
  79 00cc 4160     		str r1, [r0, # 0x04]
  80 00ce 0046     		mov r0, r0
  81 00d0 4B49     		ldr r1, = 0x1010000
  82 00d2 0046     		mov r0, r0
  83 00d4 0160     		str r1, [r0]
  84              	
  85              	dengpll:
  86 00d6 0168     	        ldr r1, [r0]
  87 00d8 8901     		lsls r1, # 6
  88 00da FCD5     		bpl dengpll
  89              	
  90 00dc 4949     		ldr r1, = 100
  91 00de 0163     		str r1, [r0, # 0x30]
  92              	
  93              		
  94              	neicunqingling:
  95 00e0 4948     		ldr r0, = 0x20000000
  96 00e2 0021     		movs r1, # 0
  97 00e4 494B     		ldr r3, = 0x1000
  98              	neicunqinglingxunhuan:
  99 00e6 043B     		subs r3, # 4
 100 00e8 C150     		str r1, [r0, r3]
 101 00ea FCD1     		bne neicunqinglingxunhuan
 102              	
 103              	_waisheshizhong:			 @ 外设时钟
 104              		@ +0x14=RCC_AHBENR
 105              		@ 0=DMA 2=SRAM 4=FLITF 6=CRC  17=PA  18=PB 19=PC 20=PD 22=PF
 106 00ec 4148     		ldr r0, = 0x40021000
 107 00ee 4849     		ldr r1, = 0x60005
 108 00f0 4161     		str r1, [r0, # 0x14]
 109              	
ARM GAS  1.s 			page 3


 110              		@ +0x18外设时钟使能寄存器 (RCC_APB2ENR)
 111              		@ 0=SYSCFG 5=USART6EN 9=ADC 11=TIM1 12=SPI1 14=USART1
 112              		@ 16=TIM15 17=TIM16 18=TIM17 22=DBGMCU
 113 00f2 4849     		ldr r1, = 0xa00
 114 00f4 8161     		str r1, [r0, # 0x18]
 115              		@+0X1C=RCC_APB1ENR
 116              		@ 1=TIM3 4=TIM6 5=TIM7 8=TIM14 11=WWDG 14=SPI 17=USRT2 18=USART3
 117              		@ 20=USART5 21=I2C1 22=I2C2  23=USB 28=PWR
 118              	
 119              	
 120              	io_she_zhi:
 121              		@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
 122              		@a(0x48000000)b(0x48000400)c(0x48000800)d(0x48000c00)f(0x48001400)
 123              		@ 输入（00），通用输出（01），复用功能（10），模拟（11）
 124              		@偏移0x4 = 端口输出类型 @ （0 推挽），（ 1 开漏）
 125              		@偏移0x8 = 输出速度  00低速， 01中速， 11高速
 126              		@偏移0xC = 上拉下拉 (00无上下拉，  01 上拉， 10下拉)
 127              		@偏移0x10 = 输入数据寄存器
 128              		@偏移0x14 = 输出数据寄存器
 129              		@偏移0x18 = 端口开  0-15置位
 130              		@偏移0x28 = 端口关
 131              		@0X20 = 复用低
 132              		@GPIO口0（0-3位）每个IO口占用4位
 133              		@ AF0 = 0X0000, AF1 = 0X0001, AF2 = 0X0010 AF3 = 0X0011, AF4 = 0X0100
 134              		@ AF5 = 0X0101, AF6 = 0X0111, AF7 = 0X1000
 135              		@0x24 = 复用高
 136              		@GPIO口8 （0-3位）每个IO口占用4位
 137              		@ AF0 = 0X0000, AF1 = 0X0001, AF2 = 0X0010 AF3 = 0X0011, AF4 = 0X0100
 138              		@ AF5 = 0X0101, AF6 = 0X0111, AF7 = 0X1000
 139              		@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
 140              		
 141 00f6 4848     		ldr r0, = 0x48000000
 142 00f8 4849     		ldr r1, = 0x28001300
 143 00fa 0160     		str r1, [r0]
 144              	
 145 00fc 4848     		ldr r0, = 0x48000400
 146 00fe 0821     		movs r1, # 0x08 @ pb1
 147 0100 0160     		str r1, [r0]
 148 0102 2021     		movs r1, # 0x20
 149 0104 0162     		str r1, [r0, # 0x20]
 150              	_adcchushihua:
 151 0106 4748     	        ldr r0, = 0x40012400  @ adc基地址
 152 0108 4749     	        ldr r1, = 0x80000000
 153 010a 8160     	        str r1, [r0, # 0x08]  @ ADC 控制寄存器 (ADC_CR)  @adc校准
 154              	_dengadcjiaozhun:
 155 010c 8168     	        ldr r1, [r0, # 0x08]
 156 010e 0900     	        movs r1, r1
 157 0110 FCD4     	        bmi _dengadcjiaozhun   @ 等ADC校准
 158 0112 0121     		movs r1, # 1
 159 0114 0160     		str r1, [r0]
 160              	_kaiadc:
 161 0116 8168     	        ldr r1, [r0, # 0x08]
 162 0118 0122     	        movs r2, # 0x01
 163 011a 1143     	        orrs r1, r1, r2
 164 011c 8160     	        str r1, [r0, # 0x08]
 165              	_deng_adc_wen_ding:
 166 011e 0168     	        ldr r1, [r0]
ARM GAS  1.s 			page 4


 167 0120 C907     	        lsls r1, r1, # 31
 168 0122 FCD5     	        bpl _deng_adc_wen_ding @ 等ADC稳定
 169              	_tongdaoxuanze:
 170 0124 4049     	        ldr r1, = 0x80000000
 171 0126 0161     	        str r1, [r0, # 0x10]
 172 0128 1021     	        movs r1, # 0x10
 173 012a 8162     	        str r1, [r0, # 0x28]    @ 通道选择寄存器 (ADC_CHSELR)
 174 012c 3F49     	        ldr r1, = 0x803 
 175 012e C160     	        str r1, [r0, # 0x0c]    @ 配置寄存器 1 (ADC_CFGR1)
 176 0130 0021     	        movs r1, # 0
 177 0132 4161     		str r1, [r0, # 0x14]    @ ADC 采样时间寄存器 (ADC_SMPR)
 178 0134 8168     	        ldr r1, [r0, # 0x08]
 179 0136 3E4A     	        ldr r2, = 0x04         @ 开始转换
 180 0138 1143     		orrs r1, r1, r2
 181 013a 8160     	        str r1, [r0, # 0x08]    @ 控制寄存器 (ADC_CR)
 182              	
 183              	
 184              		
 185              	dmachushihua:
 186              	        @+0=LSR,+4=IFCR,
 187              	        @+8=CCR1,+c=CNDTR1,+10=CPAR1+14=CMAR1,
 188              	        @+1c=CCR2,+20=CNDTR2,+24=CPAR2,+28=CMAR2
 189              	        @+30=CCR3,+34=CNDTR3,+38=CPAR2,+3c=CMAR3
 190              	        @+44=CCR4,+48=CNDTR4,+4c=CPAR4,+50=CMAR4
 191              	        @+58=CCR5,+5c=CNDTR5,+60=CPAR5,+64=CMAR5
 192              	        @+6C=CCR6,+70=CNDTR6,+74=CPAR6,+78=CMAR6
 193              	        @+80=CCR7,+84=CNDTR7,+88=CPAR7,+8c=CMAR7
 194              	
 195              	        @tim1ch3DMA
 196 013c 3D48     	        ldr r0, = 0x40020000
 197 013e 3E49     	        ldr r1, = 0x40012c3c @ 外设地址
 198 0140 0166     	        str r1, [r0, # 0x60]
 199 0142 3E49     	        ldr r1, = zheng_xian_biao @ 储存器地址
 200 0144 4166     	        str r1, [r0, # 0x64]
 201 0146 2F49     	        ldr r1, = 100             @点数
 202 0148 C165     	        str r1, [r0, # 0x5c]
 203 014a 3D49     	        ldr r1, = 0x35b1         @ 储存到外设
 204 014c 8165     	        str r1, [r0, # 0x58]
 205              		@ adc dma 
 206 014e 3948     		ldr r0, = 0x40020000
 207 0150 3C49     		ldr r1, = 0x40012440
 208 0152 0161     		str r1, [r0, # 0x10]
 209 0154 3C49     		ldr r1, = dianyabiao
 210 0156 4161     		str r1, [r0, # 0x14]
 211 0158 2A49     		ldr r1, =  100
 212 015a C160     		str r1, [r0, # 0x0c]
 213 015c 3B49     		ldr r1, = 0xaa1		@ 5a1
 214 015e 8160     		str r1, [r0, # 0x08]
 215              	
 216              	tim1chushiha:
 217 0160 3B48     	        ldr r0, = 0x40012c00 @ tim1_cr1
 218 0162 0021     	        movs r1, # 0
 219 0164 8162     	        str r1, [r0, # 0x28] @ psc
 220 0166 3B49     	        ldr r1, = 56
 221 0168 C162     	        str r1, [r0, # 0x2c] @ ARR
 222              		@	movs r1, # 0x40
 223 016a 2021     		movs r1, # 0x20
ARM GAS  1.s 			page 5


 224 016c 4160     		str r1, [r0, # 0x04] @ TRGO
 225 016e 3821     		movs r1, # 0x38
 226 0170 8161     		str r1, [r0, # 0x18] @ ccmr1 cc1
 227 0172 3821     		movs r1, # 56
 228 0174 4163     		str r1, [r0, # 0x34]
 229 0176 3849     	        ldr r1, = 0x68
 230 0178 C161     	        str r1, [r0, # 0x1c] @ ccmr2  CC3
 231 017a 3849     	        ldr r1, = 0x400    @  CC3
 232 017c 0162     	        str r1, [r0, # 0x20] @ ccer
 233 017e 3849     	        ldr r1, = 0x8000
 234 0180 4164     	        str r1, [r0, # 0x44] @ BDTR
 235 0182 3849     	        ldr r1, = 0x800 @ CC3 DMA
 236 0184 C160     	        str r1, [r0, # 0x0c] @ DIER
 237 0186 3849     	        ldr r1, = 0x81
 238 0188 0160     	        str r1, [r0]
 239              		
 240              	__ting:
 241 018a 384B     		ldr r3, = 0x20000128
 242 018c 384A     		ldr r2, = lvboqizhizhen
 243 018e 1B68     		ldr r3, [r3]
 244 0190 3848     		ldr r0, =lvboqihuanchong
 245 0192 FF21     		movs r1, # 0xff
 246 0194 00F013F8 		bl _lvboqi
 247 0198 0446     		mov r4, r0
 248 019a A446     		mov r12, r4
 249 019c 364D     		ldr r5, = 0xd00
 250 019e 641B     		subs r4, r4, r5
 251 01a0 364B     		ldr r3, = 0x200001a8
 252 01a2 374A     		ldr r2, = lvboqizhizhen1
 253 01a4 1B68     		ldr r3, [r3]
 254 01a6 3748     		ldr r0, = lvboqihuanchong1
 255 01a8 FF21     		movs r1, # 0xff
 256 01aa 00F008F8 		bl _lvboqi
 257 01ae 1A4E     		ldr r6, = 0x48000000
 258 01b0 4027     		movs r7, # 0x40
 259 01b2 001B     		subs r0, r0, r4
 260 01b4 01D4     		bmi __kai
 261              	__guan:
 262 01b6 B762     		str r7, [r6, # 0x28]
 263 01b8 E7E7     		b __ting
 264              	__kai:
 265 01ba B761     		str r7, [r6, # 0x18]
 266 01bc E5E7     		b __ting
 267              	
 268              	_lvboqi:				@滤波器
 269              				@R0=地址，R1=长度,r2=表指针地址,r3=ADC数值
 270              				@出R0=结果
 271 01be FEB5     		push {r1-r7,lr}	
 272 01c0 1568     		ldr r5, [r2]		@读出表指针
 273 01c2 4E00     		lsls r6, r1, # 1	
 274 01c4 4353     		strh r3, [r0, r5]	@数值写到滤波器缓冲区
 275 01c6 0235     		adds r5, r5, # 2
 276 01c8 B542     		cmp r5, r6
 277 01ca 00D1     		bne _lvboqimeidaohuanchongquding
 278 01cc 0025     		movs r5, # 0
 279              	_lvboqimeidaohuanchongquding:
 280 01ce 1560     		str r5, [r2]
ARM GAS  1.s 			page 6


 281 01d0 0027     		movs r7, # 0
 282              	_lvboqixunhuan:
 283 01d2 B542     		cmp r5, r6
 284 01d4 00D1     		bne _lvbozonghe
 285 01d6 0025     		movs r5, # 0
 286              	_lvbozonghe:
 287 01d8 445B     		ldrh r4, [r0, r5]
 288 01da 0235     		adds r5, r5, # 2
 289 01dc 3F19     		adds r7, r7, r4
 290 01de 0139     		subs r1, r1, # 1
 291 01e0 F7D1     		bne _lvboqixunhuan
 292 01e2 3812     		asrs r0, r7, # 8	@修改
 293 01e4 FEBD     		pop {r1-r7,pc}
 294              	
 295              	_nmi_handler:
 296 01e6 7047     		bx lr
 297              	_hard_fault:
 298 01e8 7047     		bx lr
 299              	_svc_handler:
 300 01ea 7047     		bx lr
 301              	_pendsv_handler:
 302 01ec 7047     		bx lr
 303              	_systickzhongduan:
 304              	aaa:
 305 01ee 7047     		bx lr
 306              	
 307 01f0 00200240 	
 307      00100240 
 307      01000100 
 307      02001500 
 307      00000101 
ARM GAS  1.s 			page 7


DEFINED SYMBOLS
                 1.s:5      .data:0000000000000000 zheng_xian_biao
                 1.s:7      .data:00000000000000ca $d
                 1.s:9      *ABS*:0000000020001000 STACKINIT
                 1.s:10     *ABS*:0000000020000100 dianyabiao
                 1.s:11     *ABS*:0000000020000300 lvboqizhizhen
                 1.s:12     *ABS*:0000000020000304 lvboqihuanchong
                 1.s:13     *ABS*:0000000020000600 lvboqizhizhen1
                 1.s:14     *ABS*:0000000020000604 lvboqihuanchong1
                 1.s:16     .text:0000000000000000 vectors
                 1.s:61     .text:00000000000000b0 _start
                 1.s:295    .text:00000000000001e6 _nmi_handler
                 1.s:297    .text:00000000000001e8 _hard_fault
                 1.s:299    .text:00000000000001ea _svc_handler
                 1.s:301    .text:00000000000001ec _pendsv_handler
                 1.s:303    .text:00000000000001ee _systickzhongduan
                 1.s:304    .text:00000000000001ee aaa
                 1.s:62     .text:00000000000000b0 shizhong
                            .text:0000000000000000 $d
                 1.s:63     .text:00000000000000b0 $t
                 1.s:69     .text:00000000000000bc denghse
                 1.s:73     .text:00000000000000c2 dengpllguan
                 1.s:85     .text:00000000000000d6 dengpll
                 1.s:94     .text:00000000000000e0 neicunqingling
                 1.s:98     .text:00000000000000e6 neicunqinglingxunhuan
                 1.s:103    .text:00000000000000ec _waisheshizhong
                 1.s:120    .text:00000000000000f6 io_she_zhi
                 1.s:150    .text:0000000000000106 _adcchushihua
                 1.s:154    .text:000000000000010c _dengadcjiaozhun
                 1.s:160    .text:0000000000000116 _kaiadc
                 1.s:165    .text:000000000000011e _deng_adc_wen_ding
                 1.s:169    .text:0000000000000124 _tongdaoxuanze
                 1.s:185    .text:000000000000013c dmachushihua
                 1.s:216    .text:0000000000000160 tim1chushiha
                 1.s:240    .text:000000000000018a __ting
                 1.s:268    .text:00000000000001be _lvboqi
                 1.s:264    .text:00000000000001ba __kai
                 1.s:261    .text:00000000000001b6 __guan
                 1.s:279    .text:00000000000001ce _lvboqimeidaohuanchongquding
                 1.s:282    .text:00000000000001d2 _lvboqixunhuan
                 1.s:286    .text:00000000000001d8 _lvbozonghe
                 1.s:307    .text:00000000000001f0 $d

NO UNDEFINED SYMBOLS
