ARM GAS  1.s 			page 1


   1              		@@ 单片机stm32f030f4p6						
   2              		@作者：yjmwxwx
   3              		@时间：2021-01-01
   4              		@编译器：ARM-NONE-EABI
   5              		.thumb
   6              		.syntax unified
   7              		.section .data
   8              	yjmwxwx:
   9 0000 796A6D77 		.ascii "yjmwxwx-20210101"
   9      7877782D 
   9      32303231 
   9      30313031 
  10              		
  11              		.align 4	
  12              		.equ STACKINIT,        	        0x20001000
  13              		.equ asciimabiao,		0x20000000
  14              	        .equ liangcheng,                0x20000924
  15              		.section .text
  16              	vectors:
  17 0000 00100020 		.word STACKINIT
  18 0004 B1000000 		.word _start + 1
  19 0008 5D020000 		.word _nmi_handler + 1
  20 000c 5F020000 		.word _hard_fault  + 1
  21 0010 00000000 		.word 0
  22 0014 00000000 		.word 0
  23 0018 00000000 		.word 0
  24 001c 00000000 		.word 0
  25 0020 00000000 		.word 0
  26 0024 00000000 		.word 0
  27 0028 00000000 		.word 0
  28 002c 61020000 		.word _svc_handler +1
  29 0030 00000000 		.word 0
  30 0034 00000000 		.word 0
  31 0038 63020000 		.word _pendsv_handler +1
  32 003c 65020000 		.word _systickzhongduan +1           @ 15
  33 0040 65020000 		.word aaa +1     @ _wwdg +1          @ 0
  34 0044 65020000 		.word aaa +1     @_pvd +1            @ 1
  35 0048 65020000 		.word aaa +1     @_rtc +1            @ 2
  36 004c 65020000 		.word aaa +1     @_flash +1          @ 3
  37 0050 65020000 		.word aaa +1	@ _rcc + 1           @ 4
  38 0054 65020000 		.word aaa +1      @_exti0_1  +1      @ 5
  39 0058 65020000 		.word aaa +1      @ _exti2_3 +1      @ 6
  40 005c 65020000 		.word aaa +1       @_exti4_15 +1     @ 7
  41 0060 65020000 		.word aaa +1                         @ 8
  42 0064 65020000 		.word aaa +1	@__dma_wan  +1	     @ 9
  43 0068 65020000 		.word aaa +1    @_dma1_2_3 +1        @ 10
  44 006c 65020000 		.word aaa +1       @_dma1_4_5 +1     @ 11
  45 0070 65020000 		.word aaa +1	 @_adc1 +1           @ 12
  46 0074 65020000 		.word aaa +1       @_tim1_brk_up +1  @ 13
  47 0078 65020000 		.word aaa +1        @ _tim1_cc +1    @ 14
  48 007c 65020000 		.word aaa +1         @_tim2 +1       @ 15
  49 0080 65020000 		.word aaa +1          @_tim3 +1      @ 16
  50 0084 65020000 		.word aaa +1                         @ 17
  51 0088 65020000 		.word aaa +1		             @ 18
  52 008c 65020000 		.word aaa +1	@_tim14 +1           @ 19
  53 0090 65020000 		.word aaa +1                         @ 20
  54 0094 65020000 		.word aaa +1         @_tim16 +1      @ 21
ARM GAS  1.s 			page 2


  55 0098 65020000 		.word aaa +1         @_tim17 +1      @ 22
  56 009c 65020000 		.word aaa +1          @_i2c   +1     @ 23
  57 00a0 65020000 		.word aaa +1                         @ 24
  58 00a4 65020000 		.word aaa +1           @_spi   +1    @ 25
  59 00a8 65020000 		.word aaa +1                         @ 26
  60 00ac 65020000 		.word aaa +1         @_usart1 +1     @ 27
  61              		.align 2
  62              	_start:
  63              	shizhong:
  64 00b0 6D4A     	        ldr r2, = 0x40022000   @FLASH访问控制
  65 00b2 3221     	        movs r1, # 0x32
  66 00b4 1160     	        str r1, [r2]           @FLASH缓冲 缓冲开启
  67 00b6 6D48     	        ldr r0, = 0x40021000 @ rcc
  68 00b8 6D49     		ldr r1, = 0x10001
  69 00ba 0160     	        str r1, [r0]
  70              	denghse:
  71 00bc 0168     	        ldr r1, [r0]
  72 00be 8903     	        lsls r1, r1, # 14
  73 00c0 FCD5     	        bpl denghse
  74              	dengpllguan:
  75 00c2 0168     	        ldr r1, [r0]
  76 00c4 8901     		lsls r1, r1, # 6
  77 00c6 FCD4     		bmi dengpllguan
  78 00c8 6A49     		ldr r1, = 0x150002
  79 00ca 0046     		mov r0, r0
  80 00cc 4160     		str r1, [r0, # 0x04]
  81 00ce 0046     		mov r0, r0
  82 00d0 6949     		ldr r1, = 0x1010000
  83 00d2 0046     		mov r0, r0
  84 00d4 0160     		str r1, [r0]
  85              	
  86              	dengpll:
  87 00d6 0168     	        ldr r1, [r0]
  88 00d8 8901     		lsls r1, # 6
  89 00da FCD5     		bpl dengpll
  90              	
  91              	
  92 00dc 6749     		ldr r1, = 100
  93 00de 0163     		str r1, [r0, # 0x30]
  94              	_waisheshizhong:                         @ 外设时钟
  95              	        @+0x14=RCC_AHBENR
  96              		@ 0=DMA @ 2=SRAM @ 4=FLITF@ 6=CRC @ 17=PA @ 18=PB @ 19=PC @ 20=PD @ 22=PF
  97 00e0 6248     		ldr r0, = 0x40021000
  98 00e2 6749     		ldr r1, = 0x60001
  99 00e4 4161     	        str r1, [r0, # 0x14]
 100              	
 101              	        @+0x18外设时钟使能寄存器 (RCC_APB2ENR)
 102              	        @0=SYSCFG @5=USART6EN @9=ADC @11=TIM1 @12=SPI1 @14=USART1 @16=TIM15 @17=TIM16 @18=TIM17 @22
 103 00e6 6749     	        ldr r1, = 0xa00
 104 00e8 8161     		str r1, [r0, # 0x18]
 105              		@+0X1C=RCC_APB1ENR
 106              		@ 1=TIM3 @ 4=TIM6 @ 5=TIM7 @ 8=TIM14 @ 11=WWDG @ 14=SPI @ 17=USRT2 @ 18=USART3 @ 20=USART5 @ 21=I2
 107              		@ 22=I2C2 @ 23=USB @ 28=PWR
 108 00ea 674A     	        ldr r2, = 0x902
 109 00ec C261     	        str r2, [r0, # 0x1c]
 110              	
 111              	_neicunqingling:
ARM GAS  1.s 			page 3


 112 00ee 6748     		ldr r0, = 0x20000000
 113 00f0 0021     		movs r1, # 0
 114 00f2 674B     		ldr r3, = 0x1000
 115              	_neicunqinglingxunhuan:
 116 00f4 043B     		subs r3, # 4
 117 00f6 C150     		str r1, [r0, r3]
 118 00f8 FCD1     		bne _neicunqinglingxunhuan
 119              	
 120              	_waishezhongduan:				@外设中断
 121              		@0xE000E100    0-31  写1开，写0没效
 122              		@0XE000E180    0-31 写1关，写0没效
 123              		@0XE000E200    0-31 挂起，写0没效
 124              		@0XE000E280    0-31 清除， 写0没效
 125 00fa 6648     		ldr r0, =  0xe000e100
 126 00fc 6649     		ldr r1, = 0x200 @0x10200  @ 0x10000
 127 00fe 0160     		str r1, [r0]
 128              	@_kanmengou:
 129              	@	ldr r0, = 0x40003000
 130              	@	ldr r1, = 0x5555
 131              	@	str r1, [r0]
 132              	@	movs r1, # 7
 133              	@	str r1, [r0, # 4]
 134              	@	ldr r1, = 0xfff
 135              	@	str r1, [r0, # 8]
 136              	@	ldr r1, = 0xaaaa
 137              	@	str r1, [r0]
 138              	@	ldr r1, = 0xcccc
 139              	@	str r1, [r0]
 140              	
 141              	
 142              	@_systick:				@ systick定时器初始化
 143              	@
 144              	@	ldr r0, = 0xe000e010
 145              	@	ldr r1, = 0xffffff
 146              	@	str r1, [r0, # 4]
 147              	@	str r1, [r0, # 8]	
 148              	@	movs r1, # 0x07
 149              	@	str r1, [r0]
 150              		
 151              	io_she_zhi:
 152              		@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
 153              		@a(0x48000000)b(0x48000400)c(0x48000800)d(0x48000c00)f(0x48001400)
 154              		@ 输入（00），通用输出（01），复用功能（10），模拟（11）
 155              		@偏移0x4 = 端口输出类型 @ （0 推挽），（ 1 开漏）
 156              		@偏移0x8 = 输出速度  00低速， 01中速， 11高速
 157              		@偏移0xC = 上拉下拉 (00无上下拉，  01 上拉， 10下拉)
 158              		@偏移0x10 = 输入数据寄存器
 159              		@偏移0x14 = 输出数据寄存器
 160              		@偏移0x18 = 端口开  0-15置位
 161              		@偏移0x28 = 端口关
 162              		@0X20 = 复用低
 163              		@GPIO口0（0-3位）每个IO口占用4位
 164              		@ AF0 = 0X0000, AF1 = 0X0001, AF2 = 0X0010 AF3 = 0X0011, AF4 = 0X0100
 165              		@ AF5 = 0X0101, AF6 = 0X0111, AF7 = 0X1000
 166              		@0x24 = 复用高
 167              		@GPIO口8 （0-3位）每个IO口占用4位
 168              		@ AF0 = 0X0000, AF1 = 0X0001, AF2 = 0X0010 AF3 = 0X0011, AF4 = 0X0100
ARM GAS  1.s 			page 4


 169              		@ AF5 = 0X0101, AF6 = 0X0111, AF7 = 0X1000
 170              		@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
 171              	
 172 0100 6648     		ldr r0, = 0x48000000
 173 0102 6749     		ldr r1, = 0x281454ff
 174 0104 0160     		str r1, [r0]
 175 0106 6749     		ldr r1, =  0x6f0
 176 0108 4160     		str r1, [r0, # 0x04]
 177 010a 6749     		ldr r1, = 0x100
 178 010c C160     		str r1, [r0, # 0x0c]
 179              		
 180 010e 6748     		ldr r0, = 0x48000400
 181 0110 0221     		movs r1, # 0x02
 182 0112 4160     		str r1, [r0, # 0x04]
 183 0114 0421     		movs r1, # 0x04
 184 0116 C160     		str r1, [r0, # 0x0c]
 185              	_lcdchushihua:
 186 0118 3320     		movs r0, # 0x33
 187 011a 0021     		movs r1, # 0
 188 011c 00F036F8 		bl _xielcd
 189 0120 00F02FF8 		bl _lcdyanshi
 190              	
 191 0124 3220     		movs r0, # 0x32
 192 0126 0021     		movs r1, # 0
 193 0128 00F030F8 		bl _xielcd
 194 012c 00F029F8 		bl _lcdyanshi
 195 0130 2820     		movs r0, # 0x28
 196 0132 0021     		movs r1, # 0
 197 0134 00F02AF8 		bl _xielcd
 198 0138 00F023F8 		bl _lcdyanshi
 199 013c 0C20     		movs r0, # 0x0c
 200 013e 0021     		movs r1, # 0
 201 0140 00F024F8 		bl _xielcd
 202 0144 00F01DF8 		bl _lcdyanshi
 203 0148 0120     		movs r0, # 0x01
 204 014a 0021     		movs r1, # 0
 205 014c 00F01EF8 		bl _xielcd
 206 0150 00F017F8 		bl _lcdyanshi
 207              	
 208 0154 8020     	        movs r0, # 0x80
 209 0156 5649     	        ldr r1, = yjmwxwx
 210 0158 1022     		movs r2, # 16
 211 015a 00F004F8 	        bl _lcdxianshi
 212 015e 5548     		ldr r0, = 0xffff
 213              	yjmwxwx_yanshi:
 214 0160 0138     		subs r0, r0, # 1
 215 0162 FDD1     		bne yjmwxwx_yanshi
 216              	
 217              	ting:
 218 0164 FEE7     		b ting
 219              		
 220              	_lcdxianshi:	  		@r0=LCD位置，r1=数据地址，r2=长度
 221 0166 1FB5     		push {r0-r4,lr}
 222 0168 0C46     		mov r4, r1
 223              	
 224 016a 0021     		movs r1, # 0
 225 016c 00F00EF8 		bl _xielcd
ARM GAS  1.s 			page 5


 226              	
 227 0170 0121     		movs r1, # 1
 228 0172 0023     		movs r3, # 0
 229              	_lcdxianshixunhuan:
 230 0174 E05C     		ldrb r0, [r4,r3]
 231 0176 00F009F8 		bl _xielcd
 232 017a 0133     		adds r3, r3, # 1
 233 017c 9342     		cmp r3, r2
 234 017e F9D1     		bne _lcdxianshixunhuan
 235 0180 1FBD     		pop {r0-r4,pc}
 236              	
 237              	_lcdyanshi:
 238 0182 20B5     		push {r5,lr}
 239 0184 424D     		ldr r5, = 0x1000
 240              	_lcdyanshixunhuan:
 241 0186 013D     		subs r5, r5, # 1
 242 0188 FDD1     		bne _lcdyanshixunhuan
 243 018a 20BD     		pop {r5,pc}
 244              	
 245              	_xielcd:			@入R0=8位,r1=0命令,r1=1数据
 246 018c 3FB5     		push {r0-r5,lr}
 247 018e 4A4C     		ldr r4, = liangcheng  @ 量程开关 (第6位和第7位)
 248 0190 0246     		mov r2, r0
 249 0192 2568     		ldr r5, [r4]
 250 0194 1209     		lsrs r2, r2, # 4
 251 0196 9200     		lsls r2, r2, # 2	@ 高四位
 252 0198 0007     		lsls r0, r0, # 28
 253 019a 800E     		lsrs r0, r0, # 26	@ 低四位
 254 019c C907     		lsls r1, r1, # 31
 255 019e 01D5     		bpl __lcd_ming_ling
 256              	__lcd_shu_ju:
 257 01a0 0323     		movs r3, # 0x03		@ RS = 1 E = 1
 258 01a2 00E0     		b __xie_lcd_shu_ju
 259              	__lcd_ming_ling:
 260 01a4 0223     		movs r3, # 0x02		@ RS = 0 E = 1
 261              	__xie_lcd_shu_ju:
 262 01a6 5B19     		adds r3, r3, r5
 263 01a8 0146     		mov r1, r0
 264 01aa D218     		adds r2, r2, r3
 265 01ac 1000     		movs r0, r2
 266 01ae 00F00BF8 		bl __74hc595
 267 01b2 0238     		subs r0, r0, # 0x02
 268 01b4 00F008F8 		bl __74hc595
 269 01b8 0846     		mov r0, r1
 270 01ba C018     		adds r0, r0, r3
 271 01bc 00F004F8 		bl __74hc595
 272 01c0 0238     		subs r0, r0, # 0x02
 273 01c2 00F001F8 		bl __74hc595
 274 01c6 3FBD     		pop {r0-r5,pc}
 275              		
 276              	__74hc595:			@ 入R0=8位
 277 01c8 FFB5     		push {r0-r7,lr}
 278 01ca 344E     		ldr r6, = 0x48000000
 279 01cc 2025     		movs r5, # 0x20		@ SRCLK
 280 01ce 4022     		movs r2, # 0x40		@ RCLK
 281 01d0 8023     		movs r3, # 0x80		@ SER
 282 01d2 1824     		movs r4, # 24
ARM GAS  1.s 			page 6


 283              	__595_yiweixunhuan:
 284 01d4 B262     		str r2, [r6, # 0x28]	@ rclk=0
 285 01d6 B562     		str r5, [r6, # 0x28]	@ srclk=0
 286              		@ovs r7, # 0xff
 287 01d8 384F     		ldr r7, = 0x1ff
 288              	__595_yanshi:
 289 01da 013F     		subs r7, r7, # 1
 290 01dc FDD1     		bne __595_yanshi
 291 01de 0146     		mov r1, r0
 292 01e0 A140     		lsls r1, r1, r4
 293 01e2 01D5     		bpl __ser_0
 294              	__ser_1:
 295 01e4 B361     		str r3, [r6, # 0x18]	@ ser=1
 296 01e6 00E0     		b __595_yiwei
 297              	__ser_0:
 298 01e8 B362     		str r3, [r6, # 0x28]	@ ser=0
 299              	__595_yiwei:
 300 01ea B561     		str r5, [r6, # 0x18]
 301              		@movs r7, # 0xff
 302 01ec 334F     		ldr r7, = 0x1ff
 303              	__595_yanshi1:
 304 01ee 013F     		subs r7, r7, # 1
 305 01f0 FDD1     		bne __595_yanshi1
 306 01f2 0134     		adds r4, r4, # 1
 307 01f4 202C     		cmp r4, # 32
 308 01f6 EDD1     		bne __595_yiweixunhuan
 309 01f8 B261     		str r2, [r6, # 0x18]	@ rclk=1
 310              		@movs r7, # 0xff
 311 01fa 304F     		ldr r7, = 0x1ff
 312              	__595_yanshi2:
 313 01fc 013F     		subs r7, r7, # 1
 314 01fe FDD1     		bne __595_yanshi2
 315 0200 B262     		str r2, [r6, # 0x28]	@ rclk = 0
 316 0202 FFBD     		pop {r0-r7,pc}
 317              	
 318              	
 319              	
 320              	_zhuanascii:					@ 16进制转ASCII
 321              			@ R0要转的数据， R1长度，R2结果表首地址, r3=小数点位置
 322 0204 FFB5     		push {r0-r7,lr}
 323 0206 1F46     		mov r7, r3
 324 0208 0546     		mov r5, r0
 325 020a 0E46     		mov r6, r1
 326 020c 0A21     		movs r1, # 10
 327              	_xunhuanqiuma:
 328 020e 00F012F8 		bl _chufa
 329 0212 0446     		mov r4, r0
 330 0214 4C43     		muls r4, r1
 331 0216 2B1B     		subs r3, r5, r4
 332 0218 3033     		adds r3, r3, # 0x30
 333 021a 0546     		mov r5, r0
 334 021c 013E     		subs r6, r6, # 1
 335 021e 08D0     		beq _qiumafanhui
 336 0220 BE42     		cmp r6, r7
 337 0222 02D1     		bne _meidaoxiaoshudian
 338 0224 2E24     		movs r4, # 0x2e		@小数点
 339 0226 9455     		strb r4, [r2,r6]	@插入小数点
ARM GAS  1.s 			page 7


 340 0228 013E     		subs r6, r6, # 1
 341              	_meidaoxiaoshudian:
 342 022a 9355     		strb r3, [r2,r6]
 343 022c 3600     		movs r6, r6
 344 022e EED1     		bne _xunhuanqiuma
 345 0230 FFBD     		pop {r0-r7,pc}
 346              	_qiumafanhui:
 347 0232 9355     		strb r3, [r2, r6]
 348 0234 FFBD     		pop {r0-r7,pc}
 349              	
 350              	_chufa:				@软件除法
 351              		@ r0 除以 r1 等于 商(r0)
 352 0236 1EB5     		push {r1-r4,lr}
 353 0238 0028     		cmp r0, # 0
 354 023a 0ED0     		beq _chufafanhui
 355 023c 0029     		cmp r1, # 0
 356 023e 0CD0     		beq _chufafanhui
 357 0240 0246     		mov r2, r0
 358 0242 0123     		movs r3, # 1
 359 0244 DB07     		lsls r3, r3, # 31
 360 0246 0020     		movs r0, # 0
 361 0248 0446     		mov r4, r0
 362              	_chufaxunhuan:
 363 024a 5200     		lsls r2, r2, # 1
 364 024c 6441     		adcs r4, r4, r4
 365 024e 8C42     		cmp r4, r1
 366 0250 01D3     		bcc _chufaweishubudao0
 367 0252 C018     		adds r0, r0, r3
 368 0254 641A     		subs r4, r4, r1
 369              	_chufaweishubudao0:
 370 0256 5B08     		lsrs r3, r3, # 1
 371 0258 F7D1     		bne _chufaxunhuan
 372              	_chufafanhui:
 373 025a 1EBD     		pop {r1-r4,pc}
 374              	
 375              	_nmi_handler:
 376 025c 7047     		bx lr
 377              	_hard_fault:
 378 025e 7047     		bx lr
 379              	_svc_handler:
 380 0260 7047     		bx lr
 381              	_pendsv_handler:
 382 0262 7047     		bx lr
 383              	_systickzhongduan:
 384              	aaa:
 385 0264 7047     		bx lr
 386 0266 00000020 		.ltorg
 386      02400010 
 386      02400100 
 386      01000200 
 386      15000000 
 387              		.end
ARM GAS  1.s 			page 8


DEFINED SYMBOLS
                 1.s:8      .data:0000000000000000 yjmwxwx
                 1.s:12     *ABS*:0000000020001000 STACKINIT
                 1.s:13     *ABS*:0000000020000000 asciimabiao
                 1.s:14     *ABS*:0000000020000924 liangcheng
                 1.s:16     .text:0000000000000000 vectors
                 1.s:62     .text:00000000000000b0 _start
                 1.s:375    .text:000000000000025c _nmi_handler
                 1.s:377    .text:000000000000025e _hard_fault
                 1.s:379    .text:0000000000000260 _svc_handler
                 1.s:381    .text:0000000000000262 _pendsv_handler
                 1.s:383    .text:0000000000000264 _systickzhongduan
                 1.s:384    .text:0000000000000264 aaa
                            .text:0000000000000000 $d
                 1.s:61     .text:00000000000000b0 $t
                 1.s:63     .text:00000000000000b0 shizhong
                 1.s:70     .text:00000000000000bc denghse
                 1.s:74     .text:00000000000000c2 dengpllguan
                 1.s:86     .text:00000000000000d6 dengpll
                 1.s:94     .text:00000000000000e0 _waisheshizhong
                 1.s:111    .text:00000000000000ee _neicunqingling
                 1.s:115    .text:00000000000000f4 _neicunqinglingxunhuan
                 1.s:120    .text:00000000000000fa _waishezhongduan
                 1.s:151    .text:0000000000000100 io_she_zhi
                 1.s:185    .text:0000000000000118 _lcdchushihua
                 1.s:245    .text:000000000000018c _xielcd
                 1.s:237    .text:0000000000000182 _lcdyanshi
                 1.s:220    .text:0000000000000166 _lcdxianshi
                 1.s:213    .text:0000000000000160 yjmwxwx_yanshi
                 1.s:217    .text:0000000000000164 ting
                 1.s:229    .text:0000000000000174 _lcdxianshixunhuan
                 1.s:240    .text:0000000000000186 _lcdyanshixunhuan
                 1.s:259    .text:00000000000001a4 __lcd_ming_ling
                 1.s:256    .text:00000000000001a0 __lcd_shu_ju
                 1.s:261    .text:00000000000001a6 __xie_lcd_shu_ju
                 1.s:276    .text:00000000000001c8 __74hc595
                 1.s:283    .text:00000000000001d4 __595_yiweixunhuan
                 1.s:288    .text:00000000000001da __595_yanshi
                 1.s:297    .text:00000000000001e8 __ser_0
                 1.s:294    .text:00000000000001e4 __ser_1
                 1.s:299    .text:00000000000001ea __595_yiwei
                 1.s:303    .text:00000000000001ee __595_yanshi1
                 1.s:312    .text:00000000000001fc __595_yanshi2
                 1.s:320    .text:0000000000000204 _zhuanascii
                 1.s:327    .text:000000000000020e _xunhuanqiuma
                 1.s:350    .text:0000000000000236 _chufa
                 1.s:346    .text:0000000000000232 _qiumafanhui
                 1.s:341    .text:000000000000022a _meidaoxiaoshudian
                 1.s:372    .text:000000000000025a _chufafanhui
                 1.s:362    .text:000000000000024a _chufaxunhuan
                 1.s:369    .text:0000000000000256 _chufaweishubudao0
                 1.s:386    .text:0000000000000266 $d
                 1.s:386    .text:0000000000000268 $d

NO UNDEFINED SYMBOLS
