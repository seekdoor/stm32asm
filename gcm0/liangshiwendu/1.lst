ARM GAS  1.s 			page 1


   1              		@@单片机stm32f030f4p6
   2              		@@电容小麦水分测量数码管版
   3              		@作者：yjmwxwx
   4              		@时间：2019-05-26
   5              		@编译器：ARM-NONE-EABI-AS
   6              		 .thumb
   7              		         .syntax unified
   8              		.section .data
   9              	shumaguanmabiao:
  10 0000 FC000000 		.int 0xfc,0x60,0xda,0xf2,0x66,0xb6,0xbe,0xe0,0xfe,0xf6
  10      60000000 
  10      DA000000 
  10      F2000000 
  10      66000000 
  11              	shumaguanshuaxinbiao:
  12 0028 00FE0000 		.int 0xfe00,0xfd00,0xfb00,0xf700,0xef00,0xdf00,0xbf00,0x7f00,0
  12      00FD0000 
  12      00FB0000 
  12      00F70000 
  12      00EF0000 
  13              	zheng_xian_biao:
  14 004c 30003300 		.short 0x30,0x33,0x36,0x38,0x3b,0x3e,0x41,0x44,0x47,0x49,0x4c,0x4e,0x50,0x52,0x54,0x56,0x58,0x59,0
  14      36003800 
  14      3B003E00 
  14      41004400 
  14      47004900 
  15              	yjmwxwx:
  16 0114 796A6D77 		.ascii  "yjmwxwx-201906003-xiao_mai_shui_fen_shu_ma_guan"
  16      7877782D 
  16      32303139 
  16      30363030 
  16      332D7869 
  17              		.equ STACKINIT,        	        0x20001000
  18              		.equ shumaguanma,		0x20000000
  19              		.equ jishu,			0x20000030
  20              		.equ lvbozhizhen,		0x20000040
  21              		.equ lvbohuanchong,		0x20000044
  22              		.equ wendubuchangbiao,		0x20000500
  23              		.section .text
  24              	vectors:
  25 0000 00100020 		.word STACKINIT
  26 0004 B1000000 		.word _start + 1
  27 0008 0F030000 		.word _nmi_handler + 1
  28 000c 11030000 		.word _hard_fault  + 1
  29 0010 00000000 		.word 0
  30 0014 00000000 		.word 0
  31 0018 00000000 		.word 0
  32 001c 00000000 		.word 0
  33 0020 00000000 		.word 0
  34 0024 00000000 		.word 0
  35 0028 00000000 		.word 0
  36 002c 13030000 		.word _svc_handler +1
  37 0030 00000000 		.word 0
  38 0034 00000000 		.word 0
  39 0038 15030000 		.word _pendsv_handler +1
  40 003c 17030000 		.word _systickzhongduan +1               @ 15
  41 0040 25030000 		.word aaa +1     @ _wwdg +1          @ 0
ARM GAS  1.s 			page 2


  42 0044 25030000 		.word aaa +1     @_pvd +1            @ 1
  43 0048 25030000 		.word aaa +1     @_rtc +1            @ 2
  44 004c 25030000 		.word aaa +1     @_flash +1          @ 3
  45 0050 25030000 		.word aaa +1	@ _rcc + 1          @ 4
  46 0054 25030000 		.word aaa +1      @_exti0_1  +1      @ 5
  47 0058 25030000 		.word aaa +1      @ _exti2_3 +1      @ 6
  48 005c 25030000 		.word aaa +1       @_exti4_15 +1     @ 7
  49 0060 25030000 		.word aaa +1                         @ 8
  50 0064 25030000 		.word aaa +1 	@_dma1_1  +1    @ 9
  51 0068 25030000 		.word aaa +1    @_dma1_2_3 +1        @ 10
  52 006c 25030000 		.word aaa +1       @_dma1_4_5 +1     @ 11
  53 0070 25030000 		.word aaa +1	 @_adc1 +1          @ 12
  54 0074 25030000 		.word aaa +1       @_tim1_brk_up +1  @ 13
  55 0078 25030000 		.word aaa +1        @ _tim1_cc +1    @ 14
  56 007c 25030000 		.word aaa +1         @_tim2 +1       @ 15
  57 0080 25030000 		.word aaa +1          @_tim3 +1      @ 16
  58 0084 25030000 		.word aaa +1                         @ 17
  59 0088 25030000 		.word aaa +1		                @ 18
  60 008c 25030000 		.word aaa +1	@_tim14 +1    @ 19
  61 0090 25030000 		.word aaa +1                         @ 20
  62 0094 25030000 		.word aaa +1         @_tim16 +1      @ 21
  63 0098 25030000 		.word aaa +1         @_tim17 +1      @ 22
  64 009c 25030000 		.word aaa +1          @_i2c   +1     @ 23
  65 00a0 25030000 		.word aaa +1                         @ 24
  66 00a4 25030000 		.word aaa +1           @_spi   +1    @ 25
  67 00a8 25030000 		.word aaa +1                         @ 26
  68 00ac 25030000 		.word aaa +1         @_usart1 +1     @ 27
  69              		.align 2
  70              	
  71              	_start:
  72              	shizhong:
  73 00b0 9D4A     		ldr r2, = 0x40022000   @FLASH访问控制
  74 00b2 3221     		movs r1, # 0x32
  75 00b4 1160     		str r1, [r2]           @FLASH缓冲 缓冲开启
  76 00b6 9D48     		ldr r0, = 0x40021000 @ rcc
  77 00b8 9D49     		ldr r1, = 0x10001
  78 00ba 0160     		str r1, [r0]
  79              	denghse:
  80 00bc 0168     		ldr r1, [r0]
  81 00be 8903     		lsls r1, r1, # 14
  82 00c0 FCD5     		bpl denghse
  83              	dengpllguan:
  84 00c2 0168     		ldr r1, [r0]
  85 00c4 8901     		lsls r1, r1, # 6
  86 00c6 FCD4     		bmi dengpllguan
  87 00c8 9A49     	        ldr r1, = 0x110002
  88 00ca 4160     	        str r1, [r0, # 0x04]
  89 00cc 9A49     		ldr r1, = 0x1010001
  90 00ce 0160     		str r1, [r0]
  91              	dengpll:
  92 00d0 0168     		ldr r1, [r0]
  93 00d2 8901     		lsls r1, # 6
  94 00d4 FCD5     		bpl dengpll
  95              		@0x34时钟控制寄存器 2 (RCC_CR2)
  96 00d6 0121     		movs r1, # 0x01
  97 00d8 4163     		str r1, [r0, # 0x34]  @ HSI开14M时钟
  98              	dengdai14mshizhongwending:
ARM GAS  1.s 			page 3


  99 00da 416B     		ldr r1, [r0, # 0x34]
 100 00dc 8907     		lsls r1, r1, # 30     @ 左移30位
 101 00de FCD5     		bpl dengdai14mshizhongwending  @ 等待14M时钟稳定
 102              	
 103              	_neicunqingling:
 104 00e0 9648     		ldr r0, = 0x20000000
 105 00e2 0021     		movs r1, # 0
 106 00e4 964B     		ldr r3, = 0x1000
 107              	_neicunqinglingxunhuan:
 108 00e6 043B     		subs r3, # 4
 109 00e8 C150     		str r1, [r0, r3]
 110 00ea FCD1     		bne _neicunqinglingxunhuan
 111              	
 112              	_waisheshizhong:			 @ 外设时钟
 113              		@+0x14=RCC_AHBENR
 114              		@0=DMA @2=SRAM @4=FLITF@6=CRC @17=PA @18=PB @19=PC @20=PD @22=PF
 115 00ec 8F48     		ldr r0, = 0x40021000
 116 00ee 9549     		ldr r1, = 0x460005
 117 00f0 4161     		str r1, [r0, # 0x14]
 118              	
 119              		@+0x18外设时钟使能寄存器 (RCC_APB2ENR)
 120              		@0=SYSCFG @5=USART6EN @9=ADC @11=TIM1 @12=SPI1 @14=USART1 @16=TIM15 @17=TIM16 @18=TIM17 @22=DBGMCU
 121 00f2 9549     		ldr r1, = 0xa00
 122 00f4 8161     		str r1, [r0, # 0x18]
 123              		@+0X1C=RCC_APB1ENR
 124              		@1=TIM3 @4=TIM6 @5=TIM7 @8=TIM14 @11=WWDG @14=SPI @17=USRT2 @18=USART3 @20=USART5 @21=I2C1
 125              		@22=I2C2 @23=USB @28=PWR
 126              		
 127              	tim1chushiha:
 128 00f6 9548     		ldr r0, = 0x40012c00 @ tim1_cr1
 129 00f8 0021     		movs r1, # 0
 130 00fa 8162     		str r1, [r0, # 0x28] @ psc
 131 00fc 9449     		ldr r1, = 96
 132 00fe C162     		str r1, [r0, # 0x2c] @ ARR
 133 0100 9449     		ldr r1, = 0x68
 134 0102 C161     		str r1, [r0, # 0x1c] @ ccmr2  CC3
 135 0104 9449     		ldr r1, = 0x100    @  CC3
 136 0106 0162     		str r1, [r0, # 0x20] @ ccer
 137 0108 9449     		ldr r1, = 0x8000
 138 010a 4164     		str r1, [r0, # 0x44] @ BDTR
 139 010c 9449     		ldr r1, = 0x800 @ CC3 DMA
 140 010e C160     		str r1, [r0, # 0x0c] @ DIER
 141 0110 9449     		ldr r1, = 0xe1
 142 0112 0160     		str r1, [r0]
 143              	
 144              		
 145              	_adcchushihua:
 146 0114 9448     		ldr r0, = 0x40012400  @ adc基地址
 147 0116 9549     		ldr r1, = 0x80000000
 148 0118 8160     		str r1, [r0, # 0x08]  @ ADC 控制寄存器 (ADC_CR)  @adc校准
 149              	_dengadcjiaozhun:
 150 011a 8168     		ldr r1, [r0, # 0x08]
 151 011c 0900     		 movs r1, r1
 152 011e FCD4     		bmi _dengadcjiaozhun   @ 等ADC校准
 153              	_kaiadc:
 154 0120 8168     		ldr r1, [r0, # 0x08]
 155 0122 0122     		movs r2, # 0x01
ARM GAS  1.s 			page 4


 156 0124 1143     		orrs r1, r1, r2
 157 0126 8160     		str r1, [r0, # 0x08]
 158              	_dengdaiadcwending:
 159 0128 0168     		ldr r1, [r0]
 160 012a C907     		lsls r1, r1, # 31
 161 012c FCD5     		bpl _dengdaiadcwending @ 等ADC稳定
 162              	_tongdaoxuanze:
 163 012e 9049     		ldr r1, = 0x01
 164 0130 8162     		str r1, [r0, # 0x28]    @ 通道选择寄存器 (ADC_CHSELR)
 165 0132 9049     		ldr r1, = 0x3000        @ 13 连续转换
 166 0134 C160     		str r1, [r0, # 0x0c]    @ 配置寄存器 1 (ADC_CFGR1)
 167 0136 0021     		movs r1, # 0	         @
 168 0138 4161     		str r1, [r0, # 0x14]    @ ADC 采样时间寄存器 (ADC_SMPR)
 169 013a 8168     		ldr r1, [r0, # 0x08]
 170 013c 0422     		movs r2, # 0x04         @ 开始转换
 171 013e 1143     		orrs r1, r1, r2
 172 0140 8160     		str r1, [r0, # 0x08]    @ 控制寄存器 (ADC_CR)
 173              	
 174              	dmachushihua:
 175              		@+0=LSR,+4=IFCR,
 176              		@+8=CCR1,+c=CNDTR1,+10=CPAR1+14=CMAR1,
 177              		@+1c=CCR2,+20=CNDTR2,+24=CPAR2,+28=CMAR2
 178              		@+30=CCR3,+34=CNDTR3,+38=CPAR2,+3c=CMAR3
 179              		@+44=CCR4,+48=CNDTR4,+4c=CPAR4,+50=CMAR4
 180              		@+58=CCR5,+5c=CNDTR5,+60=CPAR5,+64=CMAR5
 181              		@+6C=CCR6,+70=CNDTR6,+74=CPAR6,+78=CMAR6
 182              		@+80=CCR7,+84=CNDTR7,+88=CPAR7,+8c=CMAR7
 183              	
 184              		@tim1ch3DMA
 185 0142 8D48     		ldr r0, = 0x40020000
 186 0144 8D49     		ldr r1, = 0x40012c3c @ 外设地址
 187 0146 0166     		str r1, [r0, # 0x60]
 188 0148 8D49     		ldr r1, = zheng_xian_biao @ 储存器地址
 189 014a 4166     		str r1, [r0, # 0x64]
 190 014c 8D49     		ldr r1, = 100             @点数
 191 014e C165     		str r1, [r0, # 0x5c]
 192 0150 8D49     		ldr r1, = 0x25b1         @ 储存到外设
 193 0152 8165     		str r1, [r0, # 0x58]
 194              	
 195              	_waishezhongduan:				@外设中断
 196              		@0xE000E100    0-31  写1开，写0没效
 197              		@0XE000E180    0-31 写1关，写0没效
 198              		@0XE000E200    0-31 挂起，写0没效
 199              		@0XE000E280    0-31 清除， 写0没效
 200              	
 201              	@_systick:				@ systick定时器初始化
 202              	
 203              	@	ldr r0, = 0xe000e010
 204              	@	ldr r1, = 0xffffff
 205              	@	str r1, [r0, # 4]
 206              	@	str r1, [r0, # 8]
 207              	@	movs r1, # 0x07
 208              	@	str r1, [r0]
 209              		
 210              	io_she_zhi:
 211              		@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
 212              		@a(0x48000000)b(0x48000400)c(0x48000800)d(0x48000c00)f(0x48001400)
ARM GAS  1.s 			page 5


 213              		@ 输入（00），通用输出（01），复用功能（10），模拟（11）
 214              		@偏移0x4 = 端口输出类型 @ （0 推挽），（ 1 开漏）
 215              		@偏移0x8 = 输出速度  00低速， 01中速， 11高速
 216              		@偏移0xC = 上拉下拉 (00无上下拉，  01 上拉， 10下拉)
 217              		@偏移0x10 = 输入数据寄存器
 218              		@偏移0x14 = 输出数据寄存器
 219              		@偏移0x18 = 端口开  0-15置位
 220              		@偏移0x28 = 端口关
 221              		@0X20 = 复用低
 222              		@GPIO口0（0-3位）每个IO口占用4位
 223              		@ AF0 = 0X0000, AF1 = 0X0001, AF2 = 0X0010 AF3 = 0X0011, AF4 = 0X0100
 224              		@ AF5 = 0X0101, AF6 = 0X0111, AF7 = 0X1000
 225              		@0x24 = 复用高
 226              		@GPIO口8 （0-3位）每个IO口占用4位
 227              		@ AF0 = 0X0000, AF1 = 0X0001, AF2 = 0X0010 AF3 = 0X0011, AF4 = 0X0100
 228              		@ AF5 = 0X0101, AF6 = 0X0111, AF7 = 0X1000
 229              		@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
 230              	
 231 0154 8D48     		ldr r0, = 0x48000000
 232 0156 8E49     		ldr r1, = 0x28205403
 233 0158 0160     		str r1, [r0]
 234 015a 8E49     		ldr r1, = 0x200
 235 015c 4162     		str r1, [r0, # 0x24]
 236              		
 237              	_tingting:
 238              		@	bl __chuanganqi
 239 015e 00F008F8 		bl __dangqianwendu
 240              	@	bl __baocunwendubuchangbiao
 241 0162 764A     		ldr r2, = shumaguanma
 242 0164 0821     		movs r1, # 8
 243 0166 00F014F8 		bl _zhuanshumaguanma
 244 016a 0820     		movs r0, # 8
 245 016c 00F023F8 		bl _xieshumaguan
 246 0170 F5E7     		b _tingting
 247              	
 248              	
 249              	__dangqianwendu:
 250 0172 3EB5     		push {r1-r5,lr}
 251 0174 0020     		movs r0, # 0
 252 0176 0825     		movs r5, # 8
 253 0178 7B49     		ldr r1, = 0x40012400
 254 017a 0222     		movs r2, # 2
 255 017c 8A62     		str r2, [r1, # 0x28]
 256              	__wenduzonghe:	
 257 017e 0C6C     		ldr r4, [r1, # 0x40]
 258 0180 2044     		add r0, r0, r4
 259 0182 013D     		subs r5, r5, # 1
 260 0184 FBD1     		bne __wenduzonghe
 261 0186 C008     		lsrs r0, r0, # 3
 262 0188 834A     		ldr r2, = 3300
 263 018a 0C23     		movs r3, # 12
 264 018c 5043     	        muls r0, r2
 265 018e 1841     	        asrs r0, r0, r3
 266 0190 3EBD     		pop {r1-r5,pc}
 267              	
 268              	__baocunwendubuchangbiao:	
 269              		
ARM GAS  1.s 			page 6


 270              	_zhuanshumaguanma:@ 16进制转数码管码
 271              			@ R0要转的数据， R1长度，R2结果表首地址
 272 0192 FFB5     		push {r0-r7,lr}
 273 0194 814F     		ldr r7, = shumaguanmabiao
 274 0196 0546     		mov r5, r0
 275 0198 0E46     		mov r6, r1
 276 019a 0A21     		movs r1, # 10
 277              	_xunhuanqiuma:
 278 019c 00F0A4F8 		bl _chufa
 279 01a0 0446     		mov r4, r0
 280 01a2 4C43     		muls r4, r1
 281 01a4 2B1B     		subs r3, r5, r4
 282 01a6 9B00     		lsls r3, # 2
 283 01a8 FC58     		ldr r4, [r7, r3]
 284 01aa 1460     		str r4, [r2]
 285 01ac 0546     		mov r5, r0
 286 01ae 0432     		adds r2, r2, # 4
 287 01b0 013E     		subs r6, # 1
 288 01b2 F3D1     		bne _xunhuanqiuma
 289 01b4 FFBD     		pop {r0-r7,pc}
 290              	_xieshumaguan: @ r0=位数 @数码管码
 291 01b6 FFB5     		push {r0-r7,lr}
 292 01b8 8000     		lsls r0, r0, # 2
 293 01ba 0027     		movs r7, # 0
 294 01bc 0646     		mov r6, r0
 295 01be 5F4D     		ldr r5, = shumaguanma
 296 01c0 774A     		ldr r2, = shumaguanshuaxinbiao
 297              	_shumaguanshuaxin:
 298 01c2 EB59     		ldr r3, [r5, r7]
 299 01c4 D459     		ldr r4, [r2, r7]
 300 01c6 1C43     		orrs r4, r4, r3
 301 01c8 2046     		mov r0, r4
 302 01ca 00F004F8 		bl _xie595
 303 01ce 0437     		adds  r7, r7, # 4
 304 01d0 B742     		cmp r7, r6
 305 01d2 F6D9     		bls _shumaguanshuaxin
 306 01d4 FFBD     		pop {r0-r7,pc}
 307              		
 308              	_xie595: @ R0=要写的数据
 309 01d6 FFB5     		push {r0-r7,lr}
 310 01d8 0546     		mov r5, r0
 311 01da 4020     		movs r0, # 0x40
 312 01dc 8027     		movs r7, # 0x80 
 313 01de 2026     		movs r6, # 0x20 
 314 01e0 1023     		movs r3, # 16   @16位
 315 01e2 6A4A     		ldr r2, = 0x48000000 @ gpioa
 316 01e4 0121     		movs r1, # 0x01
 317              	_xunhuan595:
 318 01e6 9761     		str r7, [r2, # 0x18]
 319 01e8 00F014F8 		bl _yanshi
 320 01ec 0D42     		tst r5, r1
 321 01ee 01D1     		bne _xie595_0
 322 01f0 9062     		str r0, [r2, # 0x28]
 323 01f2 00E0     		b _suocun595
 324              	_xie595_0:
 325 01f4 9061     		str r0, [r2, # 0x18]
 326              	_suocun595:
ARM GAS  1.s 			page 7


 327 01f6 00F00DF8 		bl _yanshi
 328 01fa 6D08     		lsrs r5, # 1
 329 01fc 9762     		str r7, [r2, # 0x28]
 330 01fe 00F009F8 		bl _yanshi
 331 0202 013B     		subs r3, r3, # 1
 332 0204 EFD1     		bne _xunhuan595
 333 0206 9661     		str r6, [r2, # 0x18]
 334 0208 00F004F8 		bl _yanshi
 335 020c 9662     		str r6, [r2, # 0x28]
 336 020e 00F001F8 		bl _yanshi
 337 0212 FFBD     		pop {r0-r7,pc}
 338              	
 339              	
 340              	_yanshi:
 341 0214 80B4     		push {r7}
 342 0216 634F     		ldr r7, = 30
 343              	_yanshi11:
 344 0218 013F     		subs r7, # 1
 345 021a FDD1     		bne _yanshi11
 346 021c 80BC     		pop {r7}
 347 021e 7047     		bx lr
 348              	
 349              	__chuanganqi:		@出
 350              				@R0=幅值，R1=相位
 351 0220 FCB5     		push {r2-r7,lr}
 352 0222 5148     		ldr r0, = 0x40012400
 353 0224 0121     		movs r1, # 0x01
 354 0226 8162     		str r1, [r0, # 0x28]
 355 0228 00F03CF8 		bl _jianbo			@检波90、270
 356 022c 00F026F8 		bl _jisuanfuzhi			@计算90幅度
 357 0230 0246     		mov r2, r0
 358 0232 0846     		mov r0, r1
 359 0234 00F022F8 		bl _jisuanfuzhi			@计算270幅度
 360 0238 0146     		mov r1, r0
 361 023a 1046     		mov r0, r2
 362 023c 00F00DF8 		bl _xiangweipanduan		@判断相位
 363 0240 0C46     		mov r4, r1
 364 0242 0346     		mov r3, r0
 365 0244 5848     		ldr r0, = lvbohuanchong		@滤波器缓冲区
 366 0246 5949     		ldr r1, = 1024			@级数
 367 0248 594A     		ldr r2, = lvbozhizhen		@滤波器指针
 368 024a 00F039F8 		bl _lvboqi			@平滑，平均滤波器
 369 024e 2146     		mov r1, r4
 370 0250 514A     		ldr r2, = 3300
 371 0252 0C23     		movs r3, # 12
 372 0254 5043     		muls r0, r2
 373 0256 1841     		asrs r0, r0, r3
 374 0258 FCBD     		pop {r2-r7,pc}
 375              	
 376              	
 377              	_xiangweipanduan:		@相位判断
 378              					@入R0=90度，R1=270度
 379              					@出R0=相之间相差的数值，
 380              					@出R1=1,90度是正，R1=0，90度是负
 381 025a 04B5     		push {r2,lr}
 382 025c 0039     		subs r1, r1, # 0	@ 校准0点
 383 025e 421A     		subs r2, r0, r1
ARM GAS  1.s 			page 8


 384 0260 03D5     		bpl _adc90shizheng
 385 0262 0A1A     		subs r2, r1, r0
 386 0264 04D5     		bpl _adc90shifu
 387 0266 8842     		cmp r0, r1
 388 0268 05D1     		bne _xiangweipanduanfanhui
 389              	_adc90shizheng:
 390 026a 1046     		mov r0, r2
 391 026c 0121     		movs r1, # 1
 392 026e 04BD     		pop {r2,pc}
 393              	_adc90shifu:
 394 0270 1046     		mov r0, r2
 395 0272 0021     		movs r1, # 0
 396 0274 04BD     		pop {r2,pc}
 397              	_xiangweipanduanfanhui:
 398 0276 0020     		movs r0, # 0
 399 0278 0121     		movs r1, # 1
 400 027a 04BD     		pop {r2,pc}
 401              		
 402              		
 403              	_jisuanfuzhi:			@计算幅值
 404              					@入R0出R0
 405              					@R0=ADC90度采样
 406 027c 0EB5     		push {r1-r3,lr}
 407 027e 0028     		cmp r0, # 0
 408 0280 0FD0     		beq _adcshi0fanhui
 409 0282 4C49     		ldr r1, = 0x04		@实 Q15
 410 0284 4C4A     		ldr r2, = 0xffff8004    @虚 Q15
 411 0286 0346     		mov r3, r0
 412 0288 4843     		muls r0, r0, r1		@实
 413 028a C013     		asrs r0, r0, # 15
 414 028c 5343     		muls r3, r3, r2		@虚
 415 028e DB13     		asrs r3, r3, # 15
 416              	_shibushibushi0:		@检测实部是不是负数
 417 0290 0000     		movs r0, r0
 418 0292 01D5     		bpl _fzbushifushu1
 419 0294 C043     		mvns r0, r0		@是负数转成正数
 420 0296 0130     		adds r0, r0, # 1
 421              	_fzbushifushu1:			@检测虚部是不是负数
 422 0298 1B00     		movs  r3, r3
 423 029a 01D5     		bpl _fzbushifushu
 424 029c DB43     		mvns r3, r3		@是负数转成正数
 425 029e 0133     		adds r3, r3, # 1
 426              	_fzbushifushu:
 427 02a0 C018     		adds r0, r0, r3		@相加得到副值
 428              	_adcshi0fanhui:	
 429 02a2 0EBD     		pop {r1-r3,pc}
 430              		
 431              	_jianbo:				@检波
 432              						@输出r0=90度，R1=270度
 433 02a4 1CB5     		push {r2-r4,lr}
 434 02a6 454A     		ldr r2, = 0x4002005c
 435 02a8 454B     		ldr r3, = 0x40012440
 436 02aa 72B6     		cpsid i
 437              	_jianbo90du:
 438 02ac 1468     		ldr r4, [r2]
 439 02ae 232C     		cmp r4, # 35			@ 25
 440 02b0 FCD1     		bne _jianbo90du
ARM GAS  1.s 			page 9


 441 02b2 1868     		ldr r0, [r3]			@取出90度
 442              	_jianbo270du:
 443 02b4 1468     		ldr r4, [r2]
 444 02b6 4B2C     		cmp r4, # 75 			@ 75
 445 02b8 FCD1     		bne _jianbo270du
 446 02ba 1968     		ldr r1, [r3]
 447 02bc 62B6     		cpsie i
 448 02be 1CBD     		pop {r2-r4,pc}
 449              	
 450              	_lvboqi:				@滤波器
 451              				@R0=地址，R1=长度,r2=表指针地址,r3=ADC数值
 452              				@出R0=结果
 453 02c0 FEB5     		push {r1-r7,lr}	
 454 02c2 1568     		ldr r5, [r2]		@读出表指针
 455 02c4 4E00     		lsls r6, r1, # 1	
 456 02c6 4353     		strh r3, [r0, r5]	@数值写到滤波器缓冲区
 457 02c8 0235     		adds r5, r5, # 2
 458 02ca B542     		cmp r5, r6
 459 02cc 00D1     		bne _lvboqimeidaohuanchongquding
 460 02ce 0025     		movs r5, # 0
 461              	_lvboqimeidaohuanchongquding:
 462 02d0 1560     		str r5, [r2]
 463 02d2 0027     		movs r7, # 0
 464              	_lvboqixunhuan:
 465 02d4 B542     		cmp r5, r6
 466 02d6 00D1     		bne _lvbozonghe
 467 02d8 0025     		movs r5, # 0
 468              	_lvbozonghe:
 469 02da 445B     		ldrh r4, [r0, r5]
 470 02dc 0235     		adds r5, r5, # 2
 471 02de 3F19     		adds r7, r7, r4
 472 02e0 0139     		subs r1, r1, # 1
 473 02e2 F7D1     		bne _lvboqixunhuan
 474 02e4 B812     		asrs r0, r7, # 10	@修改
 475 02e6 FEBD     		pop {r1-r7,pc}
 476              			
 477              	_chufa:				@软件除法
 478              		@ r0 除以 r1 等于 商(r0)余数R1
 479 02e8 1EB5     		push {r1-r4,lr}
 480 02ea 0028     		cmp r0, # 0
 481 02ec 0ED0     		beq _chufafanhui
 482 02ee 0029     		cmp r1, # 0
 483 02f0 0CD0     		beq _chufafanhui
 484 02f2 0246     		mov r2, r0
 485 02f4 0123     		movs r3, # 1
 486 02f6 DB07     		lsls r3, r3, # 31
 487 02f8 0020     		movs r0, # 0
 488 02fa 0446     		mov r4, r0
 489              	_chufaxunhuan:
 490 02fc 5200     		lsls r2, r2, # 1
 491 02fe 6441     		adcs r4, r4, r4
 492 0300 8C42     		cmp r4, r1
 493 0302 01D3     		bcc _chufaweishubudao0
 494 0304 C018     		adds r0, r0, r3
 495 0306 641A     		subs r4, r4, r1
 496              	_chufaweishubudao0:
 497 0308 5B08     		lsrs r3, r3, # 1
ARM GAS  1.s 			page 10


 498 030a F7D1     		bne _chufaxunhuan
 499              	_chufafanhui:
 500 030c 1EBD     		pop {r1-r4,pc}
 501              	_nmi_handler:
 502 030e 7047     		bx lr
 503              	_hard_fault:
 504 0310 7047     		bx lr
 505              	_svc_handler:
 506 0312 7047     		bx lr
 507              	_pendsv_handler:
 508 0314 7047     		bx lr
 509              	_systickzhongduan:
 510 0316 2B4A     		ldr r2, = jishu
 511 0318 2B48     		ldr r0, = 0xe0000d04
 512 031a 1368     		ldr r3, [r2]
 513 031c 2B49     		ldr r1, = 0x02000000
 514 031e 0133     		adds r3, r3, # 1
 515 0320 1360     		str r3, [r2]
 516 0322 0160     		str r1, [r0]                 @ 清除SYSTICK中断
 517              	aaa:
 518 0324 70470000 		bx lr
 518      00200240 
 518      00100240 
 518      01000100 
 518      02001100 
ARM GAS  1.s 			page 11


DEFINED SYMBOLS
                 1.s:9      .data:0000000000000000 shumaguanmabiao
                 1.s:11     .data:0000000000000028 shumaguanshuaxinbiao
                 1.s:13     .data:000000000000004c zheng_xian_biao
                 1.s:15     .data:0000000000000114 yjmwxwx
                 1.s:17     *ABS*:0000000020001000 STACKINIT
                 1.s:18     *ABS*:0000000020000000 shumaguanma
                 1.s:19     *ABS*:0000000020000030 jishu
                 1.s:20     *ABS*:0000000020000040 lvbozhizhen
                 1.s:21     *ABS*:0000000020000044 lvbohuanchong
                 1.s:22     *ABS*:0000000020000500 wendubuchangbiao
                 1.s:24     .text:0000000000000000 vectors
                 1.s:71     .text:00000000000000b0 _start
                 1.s:501    .text:000000000000030e _nmi_handler
                 1.s:503    .text:0000000000000310 _hard_fault
                 1.s:505    .text:0000000000000312 _svc_handler
                 1.s:507    .text:0000000000000314 _pendsv_handler
                 1.s:509    .text:0000000000000316 _systickzhongduan
                 1.s:517    .text:0000000000000324 aaa
                            .text:0000000000000000 $d
                 1.s:69     .text:00000000000000b0 $t
                 1.s:72     .text:00000000000000b0 shizhong
                 1.s:79     .text:00000000000000bc denghse
                 1.s:83     .text:00000000000000c2 dengpllguan
                 1.s:91     .text:00000000000000d0 dengpll
                 1.s:98     .text:00000000000000da dengdai14mshizhongwending
                 1.s:103    .text:00000000000000e0 _neicunqingling
                 1.s:107    .text:00000000000000e6 _neicunqinglingxunhuan
                 1.s:112    .text:00000000000000ec _waisheshizhong
                 1.s:127    .text:00000000000000f6 tim1chushiha
                 1.s:145    .text:0000000000000114 _adcchushihua
                 1.s:149    .text:000000000000011a _dengadcjiaozhun
                 1.s:153    .text:0000000000000120 _kaiadc
                 1.s:158    .text:0000000000000128 _dengdaiadcwending
                 1.s:162    .text:000000000000012e _tongdaoxuanze
                 1.s:174    .text:0000000000000142 dmachushihua
                 1.s:195    .text:0000000000000154 _waishezhongduan
                 1.s:210    .text:0000000000000154 io_she_zhi
                 1.s:237    .text:000000000000015e _tingting
                 1.s:249    .text:0000000000000172 __dangqianwendu
                 1.s:270    .text:0000000000000192 _zhuanshumaguanma
                 1.s:290    .text:00000000000001b6 _xieshumaguan
                 1.s:256    .text:000000000000017e __wenduzonghe
                 1.s:268    .text:0000000000000192 __baocunwendubuchangbiao
                 1.s:277    .text:000000000000019c _xunhuanqiuma
                 1.s:477    .text:00000000000002e8 _chufa
                 1.s:297    .text:00000000000001c2 _shumaguanshuaxin
                 1.s:308    .text:00000000000001d6 _xie595
                 1.s:317    .text:00000000000001e6 _xunhuan595
                 1.s:340    .text:0000000000000214 _yanshi
                 1.s:324    .text:00000000000001f4 _xie595_0
                 1.s:326    .text:00000000000001f6 _suocun595
                 1.s:343    .text:0000000000000218 _yanshi11
                 1.s:349    .text:0000000000000220 __chuanganqi
                 1.s:431    .text:00000000000002a4 _jianbo
                 1.s:403    .text:000000000000027c _jisuanfuzhi
                 1.s:377    .text:000000000000025a _xiangweipanduan
ARM GAS  1.s 			page 12


                 1.s:450    .text:00000000000002c0 _lvboqi
                 1.s:389    .text:000000000000026a _adc90shizheng
                 1.s:393    .text:0000000000000270 _adc90shifu
                 1.s:397    .text:0000000000000276 _xiangweipanduanfanhui
                 1.s:428    .text:00000000000002a2 _adcshi0fanhui
                 1.s:416    .text:0000000000000290 _shibushibushi0
                 1.s:421    .text:0000000000000298 _fzbushifushu1
                 1.s:426    .text:00000000000002a0 _fzbushifushu
                 1.s:437    .text:00000000000002ac _jianbo90du
                 1.s:442    .text:00000000000002b4 _jianbo270du
                 1.s:461    .text:00000000000002d0 _lvboqimeidaohuanchongquding
                 1.s:464    .text:00000000000002d4 _lvboqixunhuan
                 1.s:468    .text:00000000000002da _lvbozonghe
                 1.s:499    .text:000000000000030c _chufafanhui
                 1.s:489    .text:00000000000002fc _chufaxunhuan
                 1.s:496    .text:0000000000000308 _chufaweishubudao0
                 1.s:518    .text:0000000000000326 $d
                 1.s:518    .text:0000000000000328 $d

NO UNDEFINED SYMBOLS
