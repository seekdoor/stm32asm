ARM GAS  1.s 			page 1


   1              		@@ 单片机stm32f030f4p6
   2              		@@ 阻抗桥
   3              		@作者：yjmwxwx
   4              		@时间：2019-08-12
   5              		@编译器：ARM-NONE-EABI
   6              		 .thumb
   7              		         .syntax unified
   8              	.section .data
   9              	zheng_xian_biao:
  10 0000 18001900 		.short 24,25,26,28,29,31,32,34,35,36,37,38,40,41,42,43,43,44,45,45,46,46,47,47,47,47,47,47,47,46,4
  10      1A001C00 
  10      1D001F00 
  10      20002200 
  10      23002400 
  11              	lcdshuju:
  12 00ca 796A6D77 		.ascii  "yjmwxwx-20190812"
  12      7877782D 
  12      32303139 
  12      30383132 
  13              	dianhua:	
  14 00da 20202020 		.ascii	"     15552208295"
  14      20313535 
  14      35323230 
  14      38323935 
  15              	qq:
  16 00ea 20202051 		.ascii	"   QQ:3341656346"
  16      513A3333 
  16      34313635 
  16      36333436 
  17              	xushu:
  18 00fa 6A       		.ascii "j"
  19              	fu:
  20 00fb 2D       		.ascii "-"
  21              	zheng:
  22 00fc 2B       		.ascii "+"
  23              	xiaomai:
  24 00fd 7869616F 		.ascii "xiaomai ="
  24      6D616920 
  24      3D
  25              		.equ STACKINIT,        	        0x20001000
  26              		.equ asciimabiao,		0x20000000
  27              		.equ xiangminkaiguan,		0x20000030
  28              		.equ jishu,			0x20000034
  29              		.equ jianbo,			0x20000038
  30              		.equ dianyabiao,		0x20000040
  31              		.equ lvboqizhizhen,		0x20000050
  32              		.equ lvboqihuanchong,		0x20000054
  33              		.equ lvboqizhizhen1,		0x20000254
  34              		.equ lvboqihuanchong1,		0x20000258
  35              		.equ lvboqizhizhen2,		0x20000460
  36              		.equ lvboqihuanchong2,		0x20000464
  37              		.equ lvboqizhizhen3,		0x20000670
  38              		.equ lvboqihuanchong3,		0x20000674
  39              	
  40              		.section .text
  41              	vectors:
  42 0000 00100020 		.word STACKINIT
ARM GAS  1.s 			page 2


  43 0004 B1000000 		.word _start + 1
  44 0008 65040000 		.word _nmi_handler + 1
  45 000c 67040000 		.word _hard_fault  + 1
  46 0010 00000000 		.word 0
  47 0014 00000000 		.word 0
  48 0018 00000000 		.word 0
  49 001c 00000000 		.word 0
  50 0020 00000000 		.word 0
  51 0024 00000000 		.word 0
  52 0028 00000000 		.word 0
  53 002c 69040000 		.word _svc_handler +1
  54 0030 00000000 		.word 0
  55 0034 00000000 		.word 0
  56 0038 6B040000 		.word _pendsv_handler +1
  57 003c 6D040000 		.word _systickzhongduan +1               @ 15
  58 0040 7B040000 		.word aaa +1     @ _wwdg +1          @ 0
  59 0044 7B040000 		.word aaa +1     @_pvd +1            @ 1
  60 0048 7B040000 		.word aaa +1     @_rtc +1            @ 2
  61 004c 7B040000 		.word aaa +1     @_flash +1          @ 3
  62 0050 7B040000 		.word aaa +1	@ _rcc + 1          @ 4
  63 0054 7B040000 		.word aaa +1      @_exti0_1  +1      @ 5
  64 0058 7B040000 		.word aaa +1      @ _exti2_3 +1      @ 6
  65 005c 7B040000 		.word aaa +1       @_exti4_15 +1     @ 7
  66 0060 7B040000 		.word aaa +1                         @ 8
  67 0064 7B040000 		.word aaa +1 	@_dma1_1  +1    @ 9
  68 0068 7B040000 		.word aaa +1    @_dma1_2_3 +1        @ 10
  69 006c 7B040000 		.word aaa +1       @_dma1_4_5 +1     @ 11
  70 0070 7B040000 		.word aaa +1	 @_adc1 +1          @ 12
  71 0074 7B040000 		.word aaa +1       @_tim1_brk_up +1  @ 13
  72 0078 7B040000 		.word aaa +1        @ _tim1_cc +1    @ 14
  73 007c 7B040000 		.word aaa +1         @_tim2 +1       @ 15
  74 0080 7B040000 		.word aaa +1          @_tim3 +1      @ 16
  75 0084 7B040000 		.word aaa +1                         @ 17
  76 0088 7B040000 		.word aaa +1		                @ 18
  77 008c 7B040000 		.word aaa +1	@_tim14 +1    @ 19
  78 0090 7B040000 		.word aaa +1                         @ 20
  79 0094 7B040000 		.word aaa +1         @_tim16 +1      @ 21
  80 0098 7B040000 		.word aaa +1         @_tim17 +1      @ 22
  81 009c 7B040000 		.word aaa +1          @_i2c   +1     @ 23
  82 00a0 7B040000 		.word aaa +1                         @ 24
  83 00a4 7B040000 		.word aaa +1           @_spi   +1    @ 25
  84 00a8 7B040000 		.word aaa +1                         @ 26
  85 00ac 7B040000 		.word aaa +1         @_usart1 +1     @ 27
  86              		.align 2
  87              	
  88              	_start:
  89              	shizhong:
  90 00b0 C04A     		ldr r2, = 0x40022000   @FLASH访问控制
  91 00b2 3221     		movs r1, # 0x32
  92 00b4 1160     		str r1, [r2]           @FLASH缓冲 缓冲开启
  93 00b6 C048     		ldr r0, = 0x40021000 @ rcc
  94 00b8 C049     		ldr r1, = 0x10001
  95 00ba 0160     		str r1, [r0]
  96              	denghse:
  97 00bc 0168     		ldr r1, [r0]
  98 00be 8903     		lsls r1, r1, # 14
  99 00c0 FCD5     		bpl denghse
ARM GAS  1.s 			page 3


 100              	dengpllguan:
 101 00c2 0168     		ldr r1, [r0]
 102 00c4 8901     		lsls r1, r1, # 6
 103 00c6 FCD4     		bmi dengpllguan
 104 00c8 BD49     	        ldr r1, = 0x110002
 105 00ca 4160     	        str r1, [r0, # 0x04]
 106 00cc BD49     		ldr r1, = 0x1010001
 107 00ce 0160     		str r1, [r0]
 108              	dengpll:
 109 00d0 0168     		ldr r1, [r0]
 110 00d2 8901     		lsls r1, # 6
 111 00d4 FCD5     		bpl dengpll
 112              		@0x34时钟控制寄存器 2 (RCC_CR2)
 113 00d6 0121     		movs r1, # 0x01
 114 00d8 4163     		str r1, [r0, # 0x34]  @ HSI开14M时钟
 115              	dengdai14mshizhongwending:
 116 00da 416B     		ldr r1, [r0, # 0x34]
 117 00dc 8907     		lsls r1, r1, # 30     @ 左移30位
 118 00de FCD5     		bpl dengdai14mshizhongwending  @ 等待14M时钟稳定
 119              	
 120              	_neicunqingling:
 121 00e0 B948     		ldr r0, = 0x20000000
 122 00e2 0021     		movs r1, # 0
 123 00e4 B94B     		ldr r3, = 0x1000
 124              	_neicunqinglingxunhuan:
 125 00e6 043B     		subs r3, # 4
 126 00e8 C150     		str r1, [r0, r3]
 127 00ea FCD1     		bne _neicunqinglingxunhuan
 128              	
 129              	_waisheshizhong:			 @ 外设时钟
 130              		@+0x14=RCC_AHBENR
 131              		@0=DMA @2=SRAM @4=FLITF@6=CRC @17=PA @18=PB @19=PC @20=PD @22=PF
 132 00ec B248     		ldr r0, = 0x40021000
 133 00ee B849     		ldr r1, = 0x460005
 134 00f0 4161     		str r1, [r0, # 0x14]
 135              	
 136              		@+0x18外设时钟使能寄存器 (RCC_APB2ENR)
 137              		@0=SYSCFG @5=USART6EN @9=ADC @11=TIM1 @12=SPI1 @14=USART1 @16=TIM15 @17=TIM16 @18=TIM17 @22=DBGMCU
 138 00f2 B849     		ldr r1, = 0xa00
 139 00f4 8161     		str r1, [r0, # 0x18]
 140              		@+0X1C=RCC_APB1ENR
 141              		@1=TIM3 @4=TIM6 @5=TIM7 @8=TIM14 @11=WWDG @14=SPI @17=USRT2 @18=USART3 @20=USART5 @21=I2C1
 142              		@22=I2C2 @23=USB @28=PWR
 143              	
 144              	
 145              	
 146              	_waishezhongduan:				@外设中断
 147              		@0xE000E100    0-31  写1开，写0没效
 148              		@0XE000E180    0-31 写1关，写0没效
 149              		@0XE000E200    0-31 挂起，写0没效
 150              		@0XE000E280    0-31 清除， 写0没效
 151              	
 152              	@_systick:				@ systick定时器初始化
 153              	
 154              	@	ldr r0, = 0xe000e010
 155              	@	ldr r1, = 0xffffff
 156              	@	str r1, [r0, # 4]
ARM GAS  1.s 			page 4


 157              	@	str r1, [r0, # 8]
 158              	@	movs r1, # 0x07
 159              	@	str r1, [r0]
 160              		
 161              	io_she_zhi:
 162              		@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
 163              		@a(0x48000000)b(0x48000400)c(0x48000800)d(0x48000c00)f(0x48001400)
 164              		@ 输入（00），通用输出（01），复用功能（10），模拟（11）
 165              		@偏移0x4 = 端口输出类型 @ （0 推挽），（ 1 开漏）
 166              		@偏移0x8 = 输出速度  00低速， 01中速， 11高速
 167              		@偏移0xC = 上拉下拉 (00无上下拉，  01 上拉， 10下拉)
 168              		@偏移0x10 = 输入数据寄存器
 169              		@偏移0x14 = 输出数据寄存器
 170              		@偏移0x18 = 端口开  0-15置位
 171              		@偏移0x28 = 端口关
 172              		@0X20 = 复用低
 173              		@GPIO口0（0-3位）每个IO口占用4位
 174              		@ AF0 = 0X0000, AF1 = 0X0001, AF2 = 0X0010 AF3 = 0X0011, AF4 = 0X0100
 175              		@ AF5 = 0X0101, AF6 = 0X0111, AF7 = 0X1000
 176              		@0x24 = 复用高
 177              		@GPIO口8 （0-3位）每个IO口占用4位
 178              		@ AF0 = 0X0000, AF1 = 0X0001, AF2 = 0X0010 AF3 = 0X0011, AF4 = 0X0100
 179              		@ AF5 = 0X0101, AF6 = 0X0111, AF7 = 0X1000
 180              		@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
 181              	
 182 00f6 B848     		ldr r0, = 0x48000000
 183 00f8 B849     		ldr r1, = 0x2824540f
 184 00fa 0160     		str r1, [r0]
 185 00fc B849     		ldr r1, = 0x200
 186 00fe 4162     		str r1, [r0, # 0x24]
 187              	
 188              		
 189              	dmachushihua:
 190              	        @+0=LSR,+4=IFCR,
 191              	        @+8=CCR1,+c=CNDTR1,+10=CPAR1+14=CMAR1,
 192              	        @+1c=CCR2,+20=CNDTR2,+24=CPAR2,+28=CMAR2
 193              	        @+30=CCR3,+34=CNDTR3,+38=CPAR2,+3c=CMAR3
 194              	        @+44=CCR4,+48=CNDTR4,+4c=CPAR4,+50=CMAR4
 195              	        @+58=CCR5,+5c=CNDTR5,+60=CPAR5,+64=CMAR5
 196              	        @+6C=CCR6,+70=CNDTR6,+74=CPAR6,+78=CMAR6
 197              	        @+80=CCR7,+84=CNDTR7,+88=CPAR7,+8c=CMAR7
 198              	
 199              	        @tim1ch3DMA
 200 0100 B848     	        ldr r0, = 0x40020000
 201 0102 B949     	        ldr r1, = 0x40012c3c @ 外设地址
 202 0104 0166     	        str r1, [r0, # 0x60]
 203 0106 B949     	        ldr r1, = zheng_xian_biao @ 储存器地址
 204 0108 4166     	        str r1, [r0, # 0x64]
 205 010a B949     	        ldr r1, = 100             @点数
 206 010c C165     	        str r1, [r0, # 0x5c]
 207 010e B949     	        ldr r1, = 0x35b1         @ 储存到外设
 208 0110 8165     	        str r1, [r0, # 0x58]
 209              	
 210              	tim1chushiha:
 211 0112 B948     	        ldr r0, = 0x40012c00 @ tim1_cr1
 212 0114 0021     	        movs r1, # 0
 213 0116 8162     	        str r1, [r0, # 0x28] @ psc
ARM GAS  1.s 			page 5


 214 0118 B849     	        ldr r1, = 47
 215 011a C162     	        str r1, [r0, # 0x2c] @ ARR
 216 011c B849     	        ldr r1, = 0x68
 217 011e C161     	        str r1, [r0, # 0x1c] @ ccmr2  CC3
 218 0120 B849     	        ldr r1, = 0x100    @  CC3
 219 0122 0162     	        str r1, [r0, # 0x20] @ ccer
 220 0124 B849     	        ldr r1, = 0x8000
 221 0126 4164     	        str r1, [r0, # 0x44] @ BDTR
 222 0128 B849     	        ldr r1, = 0x800 @ CC3 DMA
 223 012a C160     	        str r1, [r0, # 0x0c] @ DIER
 224 012c B849     	        ldr r1, = 0xe1
 225 012e 0160     	        str r1, [r0]
 226              	
 227              	_adcchushihua:
 228 0130 B848     	        ldr r0, = 0x40012400  @ adc基地址
 229 0132 B949     		ldr r1, = 0x80000000
 230 0134 8160     	        str r1, [r0, # 0x08]  @ ADC 控制寄存器 (ADC_CR)  @adc校准
 231              	_dengadcjiaozhun:
 232 0136 8168     	        ldr r1, [r0, # 0x08]
 233 0138 0900     	         movs r1, r1
 234 013a FCD4     	        bmi _dengadcjiaozhun   @ 等ADC校准
 235              	_kaiadc:
 236 013c 8168     	        ldr r1, [r0, # 0x08]
 237 013e 0122     	        movs r2, # 0x01
 238 0140 1143     	        orrs r1, r1, r2
 239 0142 8160     	        str r1, [r0, # 0x08]
 240              	_dengdaiadcwending:
 241 0144 0168     	        ldr r1, [r0]
 242 0146 C907     	        lsls r1, r1, # 31
 243 0148 FCD5     	        bpl _dengdaiadcwending @ 等ADC稳定
 244              	_tongdaoxuanze:
 245 014a B449     	        ldr r1, = 1
 246 014c 8162     	        str r1, [r0, # 0x28]    @ 通道选择寄存器 (ADC_CHSELR)
 247 014e B449     	        ldr r1, = 0x3000
 248 0150 C160     	        str r1, [r0, # 0x0c]    @ 配置寄存器 1 (ADC_CFGR1)
 249 0152 0021     	        movs r1, # 0
 250 0154 4161     	        str r1, [r0, # 0x14]    @ ADC 采样时间寄存器 (ADC_SMPR)
 251 0156 8168     	        ldr r1, [r0, # 0x08]
 252 0158 B24A     	        ldr r2, = 0x04         @ 开始转换
 253 015a 1143     	        orrs r1, r1, r2
 254 015c 8160     	        str r1, [r0, # 0x08]    @ 控制寄存器 (ADC_CR)
 255              	
 256              	
 257              	_lcdchushihua:
 258 015e 3320     		movs r0, # 0x33
 259 0160 0021     		movs r1, # 0
 260 0162 00F0B8F8 		bl _xielcd
 261 0166 00F0B1F8 		bl _lcdyanshi
 262 016a 3220     		movs r0, # 0x32
 263 016c 0021     		movs r1, # 0
 264 016e 00F0B2F8 		bl _xielcd
 265 0172 00F0ABF8 		bl _lcdyanshi
 266 0176 2820     		movs r0, # 0x28
 267 0178 0021     		movs r1, # 0
 268 017a 00F0ACF8 		bl _xielcd
 269 017e 00F0A5F8 		bl _lcdyanshi
 270 0182 0C20     		movs r0, # 0x0c
ARM GAS  1.s 			page 6


 271 0184 0021     		movs r1, # 0
 272 0186 00F0A6F8 		bl _xielcd
 273 018a 00F09FF8 		bl _lcdyanshi
 274 018e 0120     		movs r0, # 0x01
 275 0190 0021     		movs r1, # 0
 276 0192 00F0A0F8 		bl _xielcd
 277 0196 00F099F8 		bl _lcdyanshi
 278              	
 279              	
 280 019a C420     		movs r0, # 0xc4
 281 019c A249     		ldr r1, = xushu
 282 019e 0122     		movs r2, # 1
 283 01a0 FF23     		movs r3, # 0xff
 284 01a2 00F085F8 		bl _lcdxianshi
 285 01a6 0046     		mov r0, r0
 286 01a8 0046     		mov r0, r0
 287              		
 288              	ting:
 289 01aa 8B48     		ldr r0, = 0x48000000
 290 01ac 0121     		movs r1, # 1
 291 01ae 4902     		lsls r1, r1, # 9
 292 01b0 8161     		str r1, [r0, # 0x18]
 293 01b2 9E48     		ldr r0, = 0x40012428
 294 01b4 0121     		movs r1, # 1
 295 01b6 0160     		str r1, [r0]
 296 01b8 3220     		movs r0, # 50
 297 01ba 00F05BF8 		bl _jianbo
 298 01be 9C4B     		ldr r3, = 516			@反相补偿
 299 01c0 C018     		adds r0, r0, r3
 300 01c2 0346     		mov r3, r0
 301 01c4 9B48     	        ldr r0, = lvboqihuanchong
 302 01c6 8F49     	        ldr r1, = 256			
 303 01c8 9B4A     	        ldr r2, = lvboqizhizhen
 304 01ca 00F05DF8 	        bl _lvboqi
 305 01ce 0421     		movs r1, # 4
 306 01d0 7D4A     		ldr r2, = asciimabiao
 307 01d2 FF23     		movs r3, # 0xff
 308 01d4 00F0C1F8 		bl _zhuanascii
 309 01d8 C020     		movs r0, # 0xc0
 310 01da 7B49     		ldr r1, = asciimabiao
 311 01dc 0422     		movs r2, # 4
 312 01de 00F067F8 		bl _lcdxianshi
 313              	
 314 01e2 9248     	        ldr r0, = 0x40012428
 315 01e4 0221     	        movs r1, # 2
 316 01e6 0160     	        str r1, [r0]
 317 01e8 1920     	        movs r0, # 25
 318 01ea 00F043F8 		bl _jianbo
 319 01ee 0346     	        mov r3,	r0
 320 01f0 9248     	        ldr r0, = lvboqihuanchong1
 321 01f2 8449     	        ldr r1, = 256
 322 01f4 924A     		ldr r2, = lvboqizhizhen1
 323 01f6 00F047F8 		bl _lvboqi
 324 01fa 0421     	        movs r1, # 4
 325 01fc 724A     		ldr r2, = asciimabiao
 326 01fe FF23     	        movs r3, # 0xff
 327 0200 00F0ABF8 	        bl _zhuanascii
ARM GAS  1.s 			page 7


 328 0204 8020     	        movs r0, # 0x80
 329 0206 7049     	        ldr r1, = asciimabiao
 330 0208 0422     	        movs r2, # 4
 331 020a 00F051F8 	        bl _lcdxianshi
 332              	
 333 020e 7248     		ldr r0, = 0x48000000
 334 0210 0121     	        movs r1, # 1
 335 0212 4902     	        lsls r1, r1, # 9
 336 0214 8162     	        str r1, [r0, # 0x28]
 337 0216 8548     	        ldr r0, = 0x40012428
 338 0218 0121     		movs r1, # 1
 339 021a 0160     	        str r1, [r0]
 340 021c 3220     	        movs r0, # 50
 341 021e 00F029F8 	        bl _jianbo
 342 0222 834B     		ldr r3, = 516                   @反相补偿
 343 0224 C018     	        adds r0, r0, r3
 344 0226 0346     	        mov r3, r0
 345 0228 8648     	        ldr r0, = lvboqihuanchong2
 346 022a 7649     	        ldr r1, = 256
 347 022c 864A     	        ldr r2, = lvboqizhizhen2
 348 022e 00F02BF8 	        bl _lvboqi
 349 0232 0421     	        movs r1, # 4
 350 0234 644A     	        ldr r2, = asciimabiao
 351 0236 FF23     	        movs r3, # 0xff
 352 0238 00F08FF8 	        bl _zhuanascii
 353 023c CC20     	        movs r0, # 0xcc
 354 023e 6249     	        ldr r1, = asciimabiao
 355 0240 0422     		movs r2, # 4
 356 0242 00F035F8 	        bl _lcdxianshi
 357              	
 358 0246 7948     	        ldr r0, = 0x40012428
 359 0248 0221     	        movs r1, # 2
 360 024a 0160     	        str r1, [r0]
 361 024c 1920     	        movs r0, # 25
 362 024e 00F011F8 	        bl _jianbo
 363 0252 0346     	        mov r3, r0
 364 0254 7D48     	        ldr r0, = lvboqihuanchong3
 365 0256 6B49     	        ldr r1, = 256
 366 0258 7D4A     	        ldr r2, = lvboqizhizhen3
 367 025a 00F015F8 	        bl _lvboqi
 368 025e 0421     	        movs r1, # 4
 369 0260 594A     	        ldr r2, = asciimabiao
 370 0262 FF23     	        movs r3, # 0xff
 371 0264 00F079F8 	        bl _zhuanascii
 372 0268 8C20     	        movs r0, # 0x8c
 373 026a 5749     	        ldr r1, = asciimabiao
 374 026c 0422     	        movs r2, # 4
 375 026e 00F01FF8 	        bl _lcdxianshi
 376              	
 377 0272 9AE7     		b ting
 378              	
 379              	_jianbo:				@ 检波 @ 入口 R0=度数
 380 0274 0EB5     		push {r1-r3,lr}
 381 0276 7749     		ldr r1, = 0x4002005c
 382 0278 774A     		ldr r2, = 0x40012440
 383 027a 72B6     		cpsid i
 384              	_jianbo90du:
ARM GAS  1.s 			page 8


 385 027c 0B68     		ldr r3, [r1]
 386 027e 8342     		cmp r3, r0 
 387 0280 FCD1     		bne _jianbo90du
 388 0282 1068     		ldr r0, [r2]
 389 0284 62B6     		cpsie i
 390 0286 1CBD     		pop {r2-r4,pc}
 391              	
 392              	_lvboqi:
 393              				@滤波器
 394              				@R0=地址，R1=长度,r2=表指针地址,r3=ADC数值
 395              				@出R0=结果
 396 0288 FEB5     		push {r1-r7,lr}	
 397 028a 1568     		ldr r5, [r2]		@读出表指针
 398 028c 4E00     		lsls r6, r1, # 1	
 399 028e 4353     		strh r3, [r0, r5]	@数值写到滤波器缓冲区
 400 0290 0235     		adds r5, r5, # 2
 401 0292 B542     		cmp r5, r6
 402 0294 00D1     		bne _lvboqimeidaohuanchongquding
 403 0296 0025     		movs r5, # 0
 404              	_lvboqimeidaohuanchongquding:
 405 0298 1560     		str r5, [r2]
 406 029a 0027     		movs r7, # 0
 407              	_lvboqixunhuan:
 408 029c B542     		cmp r5, r6
 409 029e 00D1     		bne _lvbozonghe
 410 02a0 0025     		movs r5, # 0
 411              	_lvbozonghe:
 412 02a2 445B     		ldrh r4, [r0, r5]
 413 02a4 0235     		adds r5, r5, # 2
 414 02a6 3F19     		adds r7, r7, r4
 415 02a8 0139     		subs r1, r1, # 1
 416 02aa F7D1     		bne _lvboqixunhuan
 417 02ac 3812     		asrs r0, r7, # 8	@修改
 418 02ae FEBD     		pop {r1-r7,pc}
 419              	
 420              	
 421              		
 422              	_lcdxianshi:	  		@r0=LCD位置，r1=数据地址，r2=长度
 423 02b0 1FB5     		push {r0-r4,lr}
 424 02b2 0C46     		mov r4, r1
 425              	
 426 02b4 0021     		movs r1, # 0
 427 02b6 00F00EF8 		bl _xielcd
 428              	
 429 02ba 0121     		movs r1, # 1
 430 02bc 0023     		movs r3, # 0
 431              	_lcdxianshixunhuan:
 432 02be E05C     		ldrb r0, [r4,r3]
 433 02c0 00F009F8 		bl _xielcd
 434 02c4 0133     		adds r3, r3, # 1
 435 02c6 9342     		cmp r3, r2
 436 02c8 F9D1     		bne _lcdxianshixunhuan
 437 02ca 1FBD     		pop {r0-r4,pc}
 438              	
 439              	_lcdyanshi:
 440 02cc 20B5     		push {r5,lr}
 441 02ce 634D     		ldr r5, = 0x2000
ARM GAS  1.s 			page 9


 442              	_lcdyanshixunhuan:
 443 02d0 013D     		subs r5, r5, # 1
 444 02d2 FDD1     		bne _lcdyanshixunhuan
 445 02d4 20BD     		pop {r5,pc}
 446              	
 447              	_xielcd:			@入R0=8位,r1=0命令,r1=1数据
 448 02d6 3FB5     		push {r0-r5,lr}
 449 02d8 614C     		ldr r4, = xiangminkaiguan  @ 相敏开关
 450 02da 0246     		mov r2, r0
 451 02dc 2568     		ldr r5, [r4]
 452 02de 1209     		lsrs r2, r2, # 4
 453 02e0 9200     		lsls r2, r2, # 2	@ 高四位
 454 02e2 0007     		lsls r0, r0, # 28
 455 02e4 800E     		lsrs r0, r0, # 26	@ 低四位
 456 02e6 C907     		lsls r1, r1, # 31
 457 02e8 01D5     		bpl __lcd_ming_ling
 458              	__lcd_shu_ju:
 459 02ea 0323     		movs r3, # 0x03		@ RS = 1 E = 1
 460 02ec 00E0     		b __xiang_min_kai_guan
 461              	__lcd_ming_ling:
 462 02ee 0223     		movs r3, # 0x02		@ RS = 0 E = 1
 463              	__xiang_min_kai_guan:
 464 02f0 402D     		cmp r5, # 0x40
 465 02f2 01D1     		bne __kai_zheng_xiang_wei
 466 02f4 8025     		movs r5, # 0x80
 467 02f6 00E0     		b __xie_lcd_shu_ju
 468              	__kai_zheng_xiang_wei:	
 469 02f8 4025     		movs r5, # 0x40
 470              	__xie_lcd_shu_ju:
 471 02fa 2560     		str r5, [r4]
 472 02fc 5B19     		adds r3, r3, r5
 473 02fe 0146     		mov r1, r0
 474 0300 D218     		adds r2, r2, r3
 475 0302 1000     		movs r0, r2
 476 0304 00F00BF8 		bl __74hc595
 477 0308 0238     		subs r0, r0, # 0x02
 478 030a 00F008F8 		bl __74hc595
 479 030e 0846     		mov r0, r1
 480 0310 C018     		adds r0, r0, r3
 481 0312 00F004F8 		bl __74hc595
 482 0316 0238     		subs r0, r0, # 0x02
 483 0318 00F001F8 		bl __74hc595
 484 031c 3FBD     		pop {r0-r5,pc}
 485              		
 486              	__74hc595:			@ 入R0=8位
 487 031e FFB5     		push {r0-r7,lr}
 488 0320 2D4E     		ldr r6, = 0x48000000
 489 0322 2025     		movs r5, # 0x20		@ SRCLK
 490 0324 4022     		movs r2, # 0x40		@ RCLK
 491 0326 8023     		movs r3, # 0x80		@ SER
 492 0328 1824     		movs r4, # 24
 493              	__595_yiweixunhuan:
 494 032a B261     		str r2, [r6, # 0x18]	@ rclk=0
 495 032c B561     		str r5, [r6, # 0x18]	@ srclk=0
 496 032e FF27     		movs r7, # 0xff
 497              	__595_yanshi:
 498 0330 013F     		subs r7, r7, # 1
ARM GAS  1.s 			page 10


 499 0332 FDD1     		bne __595_yanshi
 500 0334 0146     		mov r1, r0
 501 0336 A140     		lsls r1, r1, r4
 502 0338 01D5     		bpl __ser_0
 503              	__ser_1:
 504 033a B362     		str r3, [r6, # 0x28]	@ ser=1
 505 033c 00E0     		b __595_yiwei
 506              	__ser_0:
 507 033e B361     		str r3, [r6, # 0x18]	@ ser=0
 508              	__595_yiwei:
 509 0340 B562     		str r5, [r6, # 0x28]
 510 0342 FF27     		movs r7, # 0xff
 511              	__595_yanshi1:
 512 0344 013F     		subs r7, r7, # 1
 513 0346 FDD1     		bne __595_yanshi1
 514 0348 0134     		adds r4, r4, # 1
 515 034a 202C     		cmp r4, # 32
 516 034c EDD1     		bne __595_yiweixunhuan
 517 034e B262     		str r2, [r6, # 0x28]	@ rclk=1
 518 0350 FF27     		movs r7, # 0xff
 519              	__595_yanshi2:
 520 0352 013F     		subs r7, r7, # 1
 521 0354 FDD1     		bne __595_yanshi2
 522 0356 B261     		str r2, [r6, # 0x18]	@ rclk = 0
 523 0358 FFBD     		pop {r0-r7,pc}
 524              	
 525              	
 526              	
 527              	_zhuanascii:					@ 16进制转ASCII
 528              			@ R0要转的数据， R1长度，R2结果表首地址, r3=小数点位置
 529 035a FFB5     		push {r0-r7,lr}
 530 035c 1F46     		mov r7, r3
 531 035e 0546     		mov r5, r0
 532 0360 0E46     		mov r6, r1
 533 0362 0A21     		movs r1, # 10
 534              	_xunhuanqiuma:
 535 0364 00F012F8 		bl _chufa
 536 0368 0446     		mov r4, r0
 537 036a 4C43     		muls r4, r1
 538 036c 2B1B     		subs r3, r5, r4
 539 036e 3033     		adds r3, r3, # 0x30
 540 0370 0546     		mov r5, r0
 541 0372 013E     		subs r6, r6, # 1
 542 0374 08D0     		beq _qiumafanhui
 543 0376 BE42     		cmp r6, r7
 544 0378 02D1     		bne _meidaoxiaoshudian
 545 037a 2E24     		movs r4, # 0x2e		@小数点
 546 037c 9455     		strb r4, [r2,r6]	@插入小数点
 547 037e 013E     		subs r6, r6, # 1
 548              	_meidaoxiaoshudian:
 549 0380 9355     		strb r3, [r2,r6]
 550 0382 3600     		movs r6, r6
 551 0384 EED1     		bne _xunhuanqiuma
 552 0386 FFBD     		pop {r0-r7,pc}
 553              	_qiumafanhui:
 554 0388 9355     		strb r3, [r2, r6]
 555 038a FFBD     		pop {r0-r7,pc}
ARM GAS  1.s 			page 11


 556              	
 557              		
 558              	_chufa:				@软件除法
 559              		@ r0 除以 r1 等于 商(r0)余数R1
 560 038c 1EB5     		push {r1-r4,lr}
 561 038e 0028     		cmp r0, # 0
 562 0390 0ED0     		beq _chufafanhui
 563 0392 0029     		cmp r1, # 0
 564 0394 0CD0     		beq _chufafanhui
 565 0396 0246     		mov r2, r0
 566 0398 0123     		movs r3, # 1
 567 039a DB07     		lsls r3, r3, # 31
 568 039c 0020     		movs r0, # 0
 569 039e 0446     		mov r4, r0
 570              	_chufaxunhuan:
 571 03a0 5200     		lsls r2, r2, # 1
 572 03a2 6441     		adcs r4, r4, r4
 573 03a4 8C42     		cmp r4, r1
 574 03a6 01D3     		bcc _chufaweishubudao0
 575 03a8 C018     		adds r0, r0, r3
 576 03aa 641A     		subs r4, r4, r1
 577              	_chufaweishubudao0:
 578 03ac 5B08     		lsrs r3, r3, # 1
 579 03ae F7D1     		bne _chufaxunhuan
 580              	_chufafanhui:
 581 03b0 1EBD     		pop {r1-r4,pc}
 582 03b2 00000020 		.ltorg
 582      02400010 
 582      02400100 
 582      01000200 
 582      11000100 
 583              	
 584              	
 585              	_nmi_handler:
 586 0464 7047     		bx lr
 587              	_hard_fault:
 588 0466 7047     		bx lr
 589              	_svc_handler:
 590 0468 7047     		bx lr
 591              	_pendsv_handler:
 592 046a 7047     		bx lr
 593              	_systickzhongduan:
 594 046c 034A     		ldr r2, = jishu
 595 046e 0448     		ldr r0, = 0xe0000d04
 596 0470 1368     		ldr r3, [r2]
 597 0472 0449     		ldr r1, = 0x02000000
 598 0474 0133     		adds r3, r3, # 1
 599 0476 1360     		str r3, [r2]
 600 0478 0160     		str r1, [r0]                 @ 清除SYSTICK中断
 601              	aaa:
 602 047a 70473400 		bx lr
 602      0020040D 
 602      00E00000 
 602      0002
ARM GAS  1.s 			page 12


DEFINED SYMBOLS
                 1.s:9      .data:0000000000000000 zheng_xian_biao
                 1.s:11     .data:00000000000000ca lcdshuju
                 1.s:13     .data:00000000000000da dianhua
                 1.s:15     .data:00000000000000ea qq
                 1.s:17     .data:00000000000000fa xushu
                 1.s:19     .data:00000000000000fb fu
                 1.s:21     .data:00000000000000fc zheng
                 1.s:23     .data:00000000000000fd xiaomai
                 1.s:25     *ABS*:0000000020001000 STACKINIT
                 1.s:26     *ABS*:0000000020000000 asciimabiao
                 1.s:27     *ABS*:0000000020000030 xiangminkaiguan
                 1.s:28     *ABS*:0000000020000034 jishu
                 1.s:29     *ABS*:0000000020000038 jianbo
                 1.s:30     *ABS*:0000000020000040 dianyabiao
                 1.s:31     *ABS*:0000000020000050 lvboqizhizhen
                 1.s:32     *ABS*:0000000020000054 lvboqihuanchong
                 1.s:33     *ABS*:0000000020000254 lvboqizhizhen1
                 1.s:34     *ABS*:0000000020000258 lvboqihuanchong1
                 1.s:35     *ABS*:0000000020000460 lvboqizhizhen2
                 1.s:36     *ABS*:0000000020000464 lvboqihuanchong2
                 1.s:37     *ABS*:0000000020000670 lvboqizhizhen3
                 1.s:38     *ABS*:0000000020000674 lvboqihuanchong3
                 1.s:41     .text:0000000000000000 vectors
                 1.s:88     .text:00000000000000b0 _start
                 1.s:585    .text:0000000000000464 _nmi_handler
                 1.s:587    .text:0000000000000466 _hard_fault
                 1.s:589    .text:0000000000000468 _svc_handler
                 1.s:591    .text:000000000000046a _pendsv_handler
                 1.s:593    .text:000000000000046c _systickzhongduan
                 1.s:601    .text:000000000000047a aaa
                            .text:0000000000000000 $d
                 1.s:86     .text:00000000000000b0 $t
                 1.s:89     .text:00000000000000b0 shizhong
                 1.s:96     .text:00000000000000bc denghse
                 1.s:100    .text:00000000000000c2 dengpllguan
                 1.s:108    .text:00000000000000d0 dengpll
                 1.s:115    .text:00000000000000da dengdai14mshizhongwending
                 1.s:120    .text:00000000000000e0 _neicunqingling
                 1.s:124    .text:00000000000000e6 _neicunqinglingxunhuan
                 1.s:129    .text:00000000000000ec _waisheshizhong
                 1.s:146    .text:00000000000000f6 _waishezhongduan
                 1.s:161    .text:00000000000000f6 io_she_zhi
                 1.s:189    .text:0000000000000100 dmachushihua
                 1.s:210    .text:0000000000000112 tim1chushiha
                 1.s:227    .text:0000000000000130 _adcchushihua
                 1.s:231    .text:0000000000000136 _dengadcjiaozhun
                 1.s:235    .text:000000000000013c _kaiadc
                 1.s:240    .text:0000000000000144 _dengdaiadcwending
                 1.s:244    .text:000000000000014a _tongdaoxuanze
                 1.s:257    .text:000000000000015e _lcdchushihua
                 1.s:447    .text:00000000000002d6 _xielcd
                 1.s:439    .text:00000000000002cc _lcdyanshi
                 1.s:422    .text:00000000000002b0 _lcdxianshi
                 1.s:288    .text:00000000000001aa ting
                 1.s:379    .text:0000000000000274 _jianbo
                 1.s:392    .text:0000000000000288 _lvboqi
ARM GAS  1.s 			page 13


                 1.s:527    .text:000000000000035a _zhuanascii
                 1.s:384    .text:000000000000027c _jianbo90du
                 1.s:404    .text:0000000000000298 _lvboqimeidaohuanchongquding
                 1.s:407    .text:000000000000029c _lvboqixunhuan
                 1.s:411    .text:00000000000002a2 _lvbozonghe
                 1.s:431    .text:00000000000002be _lcdxianshixunhuan
                 1.s:442    .text:00000000000002d0 _lcdyanshixunhuan
                 1.s:461    .text:00000000000002ee __lcd_ming_ling
                 1.s:458    .text:00000000000002ea __lcd_shu_ju
                 1.s:463    .text:00000000000002f0 __xiang_min_kai_guan
                 1.s:468    .text:00000000000002f8 __kai_zheng_xiang_wei
                 1.s:470    .text:00000000000002fa __xie_lcd_shu_ju
                 1.s:486    .text:000000000000031e __74hc595
                 1.s:493    .text:000000000000032a __595_yiweixunhuan
                 1.s:497    .text:0000000000000330 __595_yanshi
                 1.s:506    .text:000000000000033e __ser_0
                 1.s:503    .text:000000000000033a __ser_1
                 1.s:508    .text:0000000000000340 __595_yiwei
                 1.s:511    .text:0000000000000344 __595_yanshi1
                 1.s:519    .text:0000000000000352 __595_yanshi2
                 1.s:534    .text:0000000000000364 _xunhuanqiuma
                 1.s:558    .text:000000000000038c _chufa
                 1.s:553    .text:0000000000000388 _qiumafanhui
                 1.s:548    .text:0000000000000380 _meidaoxiaoshudian
                 1.s:580    .text:00000000000003b0 _chufafanhui
                 1.s:570    .text:00000000000003a0 _chufaxunhuan
                 1.s:577    .text:00000000000003ac _chufaweishubudao0
                 1.s:582    .text:00000000000003b2 $d
                 1.s:582    .text:00000000000003b4 $d
                 1.s:586    .text:0000000000000464 $t
                 1.s:602    .text:000000000000047c $d

NO UNDEFINED SYMBOLS
